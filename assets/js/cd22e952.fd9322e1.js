"use strict";(self.webpackChunkgosoline_docs=self.webpackChunkgosoline_docs||[]).push([["9526"],{5603(e,r,n){n.r(r),n.d(r,{metadata:()=>t,default:()=>x,frontMatter:()=>o,contentTitle:()=>s,toc:()=>u,assets:()=>a});var t=JSON.parse('{"id":"reference/package-fixtures","title":"Package fixtures","description":"While using gosoline you are able to define fixtures directly in code.","source":"@site/docs/reference/package-fixtures.mdx","sourceDirName":"reference","slug":"/reference/package-fixtures","permalink":"/docs/reference/package-fixtures","draft":false,"unlisted":false,"editUrl":"https://github.com/gosoline-project/docs/tree/main/docs/reference/package-fixtures.mdx","tags":[],"version":"current","frontMatter":{"title":"Package fixtures"},"sidebar":"docSidebar","previous":{"title":"Package dbx","permalink":"/docs/reference/package-dbx"},"next":{"title":"Package httpserver","permalink":"/docs/reference/package-httpserver"}}'),i=n(4848),l=n(8453);let o={title:"Package fixtures"},s="Gosoline Fixture Loader",a={},u=[{value:"Usage",id:"usage",level:2},{value:"Quick Usage",id:"quick-usage",level:2},{value:"ID Generation",id:"id-generation",level:2},{value:"Example with available fixture writers:",id:"example-with-available-fixture-writers",level:2},{value:"Named Fixtures",id:"named-fixtures",level:2},{value:"Further Information",id:"further-information",level:2}];function d(e){let r={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"gosoline-fixture-loader",children:"Gosoline Fixture Loader"})}),"\n",(0,i.jsxs)(r.p,{children:["While using ",(0,i.jsx)(r.em,{children:"gosoline"})," you are able to define fixtures directly in code."]}),"\n",(0,i.jsx)(r.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Enable fixture loading in your ",(0,i.jsx)(r.code,{children:"config.dist.yml"})," File"]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"fixtures:\n    enabled: true\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Make sure to use a custom build tag named ",(0,i.jsx)(r.code,{children:"fixtures"})]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Define your fixtures in code while using one of the built in ",(0,i.jsx)(r.code,{children:"FixtureWriter"}),"s and defining a slice of\n",(0,i.jsx)(r.code,{children:"[]fixtures.FixtureSet{}"})," or use ",(0,i.jsx)(r.code,{children:"fixtures.FixtureSetFactory"})," or ",(0,i.jsx)(r.code,{children:"fixtures.FixtureSetsFactory"})," depending on your use-case.\nFor more details check the ",(0,i.jsx)(r.code,{children:"/examples/fixtures"})," Directory or read the short example below."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"fixtures.FixtureSet"})," interface allows you to define any custom implementation for writing fixture sets to their\ndestination and take control of purging prior writing too. You can however use the ",(0,i.jsx)(r.code,{children:"fixures.simpleFixtureSet"})," via the\n",(0,i.jsx)(r.code,{children:"fixtures.NewSimpleFixtureSet"})," factory func to use a simple yet effective and prebuilt solution. This is the simpleFixtureSet\nstruct definition:"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"type simpleFixtureSet[T any] struct {\n	Enabled  bool\n	Purge    bool\n	Writer   FixtureWriter\n	Fixtures NamedFixtures[T]\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:["You can easily define multiple fixtures for different destinations in one file, enable/disable them or even enable/disable\npurging for each ",(0,i.jsx)(r.code,{children:"fixtures.FixtureSet"})," via the ",(0,i.jsx)(r.code,{children:"fixtures.WithEnabled"})," and ",(0,i.jsx)(r.code,{children:"fixtures.WithPurge"})," ",(0,i.jsx)(r.code,{children:"fixtures.FixtureSetOption"}),"\nfor the ",(0,i.jsx)(r.code,{children:"fixtures.NewSimpleFixtureSet"})," func."]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Currently there are 7 different FixtureWriter implementations for loading fixtures:"}),"\n"]}),"\n",(0,i.jsxs)("table",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Implementation"}),(0,i.jsx)("td",{children:"Direct creation"}),(0,i.jsx)("td",{children:"Factory for use with fixtures.NewFixtureSetsFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Blob stores (AWS S3)"}),(0,i.jsx)("td",{children:"fixtures.NewBlobFixtureWriter`"}),(0,i.jsx)("td",{children:"fixtures.BlobFixtureSetFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"AWS DynamoDB"}),(0,i.jsx)("td",{children:"fixtures.NewDynamoDbFixtureWriter`"}),(0,i.jsx)("td",{children:"fixtures.DynamoDbFixtureSetFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"KvStore backed by AWS DynamoDB"}),(0,i.jsx)("td",{children:"fixtures.DynamoDbKvStoreFixtureWriterFactory`"}),(0,i.jsx)("td",{children:"fixtures.DynamoDbKvStoreFixtureSetFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"MySQL (backed by gosoline ORM implementation)"}),(0,i.jsx)("td",{children:"fixtures.MysqlOrmFixtureWriterFactory`"}),(0,i.jsx)("td",{children:"fixtures.MysqlOrmFixtureSetFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"MySQL (plain columns/values)"}),(0,i.jsx)("td",{children:"fixtures.MysqlPlainFixtureWriterFactory`"}),(0,i.jsx)("td",{children:"fixtures.MysqlPlainFixtureSetFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"MySQL (sqlx named prepared statements)"}),(0,i.jsx)("td",{children:"fixtures.NewMysqlSqlxFixtureWriter`"}),(0,i.jsx)("td",{children:"fixtures.MysqlSqlxFixtureSetFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Redis"}),(0,i.jsx)("td",{children:"fixtures.NewRedisFixtureWriter`"}),(0,i.jsx)("td",{children:"fixtures.RedisFixtureSetFactory"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"KvStore backed by Redis"}),(0,i.jsx)("td",{children:"fixtures.NewRedisKvStoreFixtureWriter`"}),(0,i.jsx)("td",{children:"fixtures.RedisKvStoreFixtureSetFactory"})]})]}),"\n",(0,i.jsx)(r.h2,{id:"quick-usage",children:"Quick Usage"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["During the creation of your Application make sure to pass the ",(0,i.jsx)(r.code,{children:"WithFixtureSetsFactory"})," option and provide the group name\nand a fixture sets factory as arguments of type ",(0,i.jsx)(r.code,{children:"fixtures.WithFixtureSetsFactory"}),". The ",(0,i.jsx)(r.code,{children:"default"})," group is enabled by default."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'func main() {\n	application.Run(\n		application.WithConfigFile("config.dist.yml", "yml"),\n		application.WithFixtureSetFactory("default", fixtureSetsFactory),\n		application.WithModuleFactory("main", func(ctx context.Context, config cfg.Config, logger log.Logger) (kernel.Module, error) {\n			return &mod{}, nil\n		}),\n	)\n}\n'})}),"\n",(0,i.jsxs)(r.p,{children:["For blob stores (when using the ",(0,i.jsx)(r.code,{children:"BlobFixtureWriterFactory"}),") you need a configuration entry added:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"blob:\n  blobconfig:\n    bucket: s3-fixtures-bucket\n"})}),"\n",(0,i.jsx)(r.h2,{id:"id-generation",children:"ID Generation"}),"\n",(0,i.jsxs)(r.p,{children:["You can also generate a locally unique identifier for your fixtures via ",(0,i.jsx)(r.code,{children:"fixtures.AutoNumbered"}),"."]}),"\n",(0,i.jsx)(r.h2,{id:"example-with-available-fixture-writers",children:"Example with available fixture writers:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'func main() {\n	application.Run(\n		application.WithConfigFile("config.dist.yml", "yml"),\n		application.WithFixtureSetFactory("default", fixtureSetsFactory),\n		application.WithModuleFactory("main", func(ctx context.Context, config cfg.Config, logger log.Logger) (kernel.Module, error) {\n			return &mod{}, nil\n		}),\n	)\n}\n\nvar autoNumbered = fixtures.NewAutoNumberedFrom(2)\n\nfunc mysqlOrmFixtureSet(ctx context.Context, config cfg.Config, logger log.Logger) (fixtures.FixtureSet, error) {\n	mysqlMetadata := &db_repo.Metadata{\n		ModelId: mdl.ModelId{\n			Name: "orm_fixture_example",\n		},\n	}\n	mysqlOrmWriter, err := fixtures.NewMysqlOrmFixtureWriter(ctx, config, logger, mysqlMetadata)\n	if err != nil {\n		return nil, fmt.Errorf("failed to initialize mysql orm writer: %w", err)\n	}\n\n	return fixtures.NewSimpleFixtureSet(fixtures.NamedFixtures[OrmFixtureExample]{\n		&fixtures.NamedFixture[OrmFixtureExample]{\n			Name: "foo",\n			Value: OrmFixtureExample{\n				Model: db_repo.Model{\n					Id: autoNumbered.GetNext(),\n				},\n				Name: mdl.Box("example"),\n			},\n		},\n	}, mysqlOrmWriter), nil\n}\n\nfunc mysqlPlainFixtureSet(ctx context.Context, config cfg.Config, logger log.Logger) (fixtures.FixtureSet, error) {\n	mysqlPlainWriter, err := fixtures.NewMysqlPlainFixtureWriter(ctx, config, logger, &fixtures.MysqlPlainMetaData{\n		TableName: "plain_fixture_example",\n		Columns:   []string{"id", "name"},\n	})\n	if err != nil {\n		return nil, fmt.Errorf("failed to initialize mysql plain writer: %w", err)\n	}\n\n	return fixtures.NewSimpleFixtureSet(fixtures.NamedFixtures[fixtures.MysqlPlainFixtureValues]{\n		{\n			Name:  "foo2",\n			Value: fixtures.MysqlPlainFixtureValues{1, "testName1"},\n		},\n		{\n			Name:  "foo3",\n			Value: fixtures.MysqlPlainFixtureValues{2, "testName2"},\n		},\n	}, mysqlPlainWriter), nil\n}\n\nfunc dynamodbKvstoreFixtureSet(ctx context.Context, config cfg.Config, logger log.Logger) (fixtures.FixtureSet, error) {\n	dynamoDbKvStoreWriter, err := fixtures.NewDynamoDbKvStoreFixtureWriter[DynamoDbExampleModel](ctx, config, logger, &mdl.ModelId{\n		Project:     "gosoline",\n		Environment: "dev",\n		Family:      "example",\n		Application: "fixture-loader",\n		Name:        "exampleModel",\n	})\n	if err != nil {\n		return nil, fmt.Errorf("failed to initialize dynamodb kvstore writer: %w", err)\n	}\n\n	return fixtures.NewSimpleFixtureSet(fixtures.NamedFixtures[*fixtures.KvStoreFixture]{\n		{\n			Name: "kv_somekey",\n			Value: &fixtures.KvStoreFixture{\n				Key:   "SomeKey",\n				Value: DynamoDbExampleModel{Name: "Some Name", Value: "Some Value"},\n			},\n		},\n	}, dynamoDbKvStoreWriter), nil\n}\n\nfunc redisFixtureSet(ctx context.Context, config cfg.Config, logger log.Logger) (fixtures.FixtureSet, error) {\n	redisWriter, err := fixtures.NewRedisFixtureWriter(ctx, config, logger, "default", fixtures.RedisOpSet)\n	if err != nil {\n		return nil, fmt.Errorf("failed to initialize redis writer: %w", err)\n	}\n\n	return fixtures.NewSimpleFixtureSet(fixtures.NamedFixtures[*fixtures.RedisFixture]{\n		{\n			Name: "redis_example",\n			Value: &fixtures.RedisFixture{\n				Key:    "example-key",\n				Value:  "bar",\n				Expiry: 1 * time.Hour,\n			},\n		},\n	}, redisWriter), nil\n}\n\nfunc dynamodbFixtureSet(ctx context.Context, config cfg.Config, logger log.Logger) (fixtures.FixtureSet, error) {\n	dynamodbWriter, err := fixtures.NewDynamoDbFixtureWriter(ctx, config, logger, &ddb.Settings{\n		ModelId: mdl.ModelId{\n			Project:     "gosoline",\n			Environment: "dev",\n			Family:      "example",\n			Application: "fixture-loader",\n			Name:        "exampleModel",\n		},\n		Main: ddb.MainSettings{\n			Model: DynamoDbExampleModel{},\n		},\n		Global: []ddb.GlobalSettings{\n			{\n				Name:               "IDX_Name",\n				Model:              DynamoDbExampleModel{},\n				ReadCapacityUnits:  1,\n				WriteCapacityUnits: 1,\n			},\n		},\n	})\n	if err != nil {\n		return nil, fmt.Errorf("failed to initialize dynamodb writer: %w", err)\n	}\n\n	return fixtures.NewSimpleFixtureSet(fixtures.NamedFixtures[*DynamoDbExampleModel]{\n		{\n			Name:  "ddb",\n			Value: &DynamoDbExampleModel{Name: "Some Name", Value: "Some Value"},\n		},\n	}, dynamodbWriter), nil\n}\n\nfunc blobFixtureSet(ctx context.Context, config cfg.Config, logger log.Logger) (fixtures.FixtureSet, error) {\n	blobWriter, err := fixtures.NewBlobFixtureWriter(ctx, config, logger, &fixtures.BlobFixturesSettings{\n		ConfigName: "test",\n		BasePath:   "../../test/test_data/s3_fixtures_test_data",\n	})\n	if err != nil {\n		return nil, fmt.Errorf("failed to initialize blob writer: %w", err)\n	}\n\n	return fixtures.NewSimpleFixtureSet(fixtures.NamedFixtures[*fixtures.BlobFixture]{}, blobWriter), nil\n}\n\nfunc fixtureSetsFactory(ctx context.Context, config cfg.Config, logger log.Logger) ([]fixtures.FixtureSet, error) {\n	mysqlOrmFs, err := mysqlOrmFixtureSet(ctx, config, logger)\n	if err != nil {\n		return nil, err\n	}\n\n	mysqlPlainFs, err := mysqlPlainFixtureSet(ctx, config, logger)\n	if err != nil {\n		return nil, err\n	}\n\n	dynamodbKvstoreFs, err := dynamodbKvstoreFixtureSet(ctx, config, logger)\n	if err != nil {\n		return nil, err\n	}\n\n	redisFs, err := redisFixtureSet(ctx, config, logger)\n	if err != nil {\n		return nil, err\n	}\n\n	dynamodbFs, err := dynamodbFixtureSet(ctx, config, logger)\n	if err != nil {\n		return nil, err\n	}\n\n	blobFs, err := blobFixtureSet(ctx, config, logger)\n	if err != nil {\n		return nil, err\n	}\n\n	return []fixtures.FixtureSet{\n		mysqlOrmFs,\n		mysqlPlainFs,\n		dynamodbKvstoreFs,\n		redisFs,\n		dynamodbFs,\n		blobFs,\n	}, nil\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"named-fixtures",children:"Named Fixtures"}),"\n",(0,i.jsx)(r.p,{children:"With named fixtures you can create some fixtures and in future fixtures refer to the already created ones, e.g. for referencing (auto numbered) IDs:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'type DynamoDbExampleModel struct {\n	Name  string `ddb:"key=hash"`\n	Value string `ddb:"global=hash"`\n}\n\nvar namedFixtures = fixtures.NamedFixtures[*DynamoDbExampleModel]{\n	{\n		Name:  "test",\n		Value: &DynamoDbExampleModel{Name: "Some Name", Value: "Some Value"},\n	},\n}\n\nfunc fixtureSetsFactory(ctx context.Context, config cfg.Config, logger log.Logger, group string) ([]fixtures.FixtureSet, error) {\n	mysqlWriter, err := db_repo.NewMysqlOrmFixtureWriter(ctx, config, logger, &db_repo.Metadata{\n		ModelId: mdl.ModelId{\n			Name: "orm_named_fixture_example",\n		},\n	})\n	if err != nil {\n		return nil, fmt.Errorf("failed to create orm fixture writer: %w", err)\n	}\n\n	return []fixtures.FixtureSet{\n		fixtures.NewSimpleFixtureSet(namedFixtures, mysqlWriter),\n	}, nil\n}\n\nfunc main() {\n	app := application.Default(\n		application.WithFixtureSetFactory("default", fixtureSetsFactory),\n	)\n\n	app.Run()\n\n	// then you can access them later\n	fx := namedFixtures.GetValueByName("test")\n	_ = fx.Value\n}\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"further-information",children:"Further Information"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Existing fixtures will be updated instead of created."}),"\n",(0,i.jsx)(r.li,{children:"When purge is enabled only the destination of the fixtures will be purged, not everything. That means for example while loading MySQL Fixtures with purge only the tables will be purged not the whole database."}),"\n",(0,i.jsxs)(r.li,{children:["If you want to use the MySQL ORM based implementation make sure that your fixture struct embeds ",(0,i.jsx)(r.code,{children:"db_repo.Model"})]}),"\n"]})]})}function x(e={}){let{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,r,n){n.d(r,{R:()=>o,x:()=>s});var t=n(6540);let i={},l=t.createContext(i);function o(e){let r=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(l.Provider,{value:r},e.children)}}}]);