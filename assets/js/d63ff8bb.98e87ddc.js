"use strict";(self.webpackChunkgosoline_docs=self.webpackChunkgosoline_docs||[]).push([["9901"],{4078(e,n,t){t.r(n),t.d(n,{metadata:()=>r,default:()=>j,frontMatter:()=>c,contentTitle:()=>h,toc:()=>u,assets:()=>p});var r=JSON.parse('{"id":"how-to/databases-sql/sqlh","title":"sqlh - SQL HTTP Handlers","description":"The sqlh package exposes database entities as REST API endpoints. Built on top of sqlr and sqlc, it provides automatic CRUD handler generation, a transformer pattern for input/output mapping, and transaction middleware for wrapping HTTP requests in database transactions.","source":"@site/docs/how-to/databases-sql/sqlh.mdx","sourceDirName":"how-to/databases-sql","slug":"/how-to/databases-sql/sqlh","permalink":"/docs/how-to/databases-sql/sqlh","draft":false,"unlisted":false,"editUrl":"https://github.com/gosoline-project/docs/tree/main/docs/how-to/databases-sql/sqlh.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"sqlh - SQL HTTP Handlers"},"sidebar":"docSidebar","previous":{"title":"sqlr - SQL Repository","permalink":"/docs/how-to/databases-sql/sqlr"},"next":{"title":"Notes on general Kafka usage","permalink":"/docs/how-to/kafka/general"}}'),s=t(4848),i=t(8453),d=t(4490);let o='package main\n\nimport (\n	"context"\n	_ "embed"\n\n	"github.com/gosoline-project/httpserver"\n	"github.com/gosoline-project/sqlh"\n	"github.com/gosoline-project/sqlr"\n	"github.com/justtrackio/gosoline/pkg/application"\n	"github.com/justtrackio/gosoline/pkg/cfg"\n	"github.com/justtrackio/gosoline/pkg/log"\n)\n\n// snippet-start: entities\ntype Author struct {\n	sqlr.Entity[int64]\n	Name  string `db:"name"`\n	Email string `db:"email"`\n}\n\n// snippet-end: entities\n\n// snippet-start: input output\ntype AuthorCreateInput struct {\n	Name  string `json:"name" binding:"required"`\n	Email string `json:"email" binding:"required"`\n}\n\ntype AuthorUpdateInput struct {\n	Name string `json:"name" binding:"required"`\n}\n\n// snippet-end: input output\n\n// snippet-start: transformer\ntype AuthorTransformer struct{}\n\nfunc (t *AuthorTransformer) TransformCreateInput(_ context.Context, input *AuthorCreateInput) (*Author, error) {\n	return &Author{\n		Name:  input.Name,\n		Email: input.Email,\n	}, nil\n}\n\nfunc (t *AuthorTransformer) TransformUpdateInput(_ context.Context, entity *Author, input *AuthorUpdateInput) (*Author, error) {\n	entity.Name = input.Name\n\n	return entity, nil\n}\n\nfunc (t *AuthorTransformer) RenderEntityResponse(_ context.Context, entity *Author) (httpserver.Response, error) {\n	return httpserver.NewJsonResponse(entity), nil\n}\n\nfunc (t *AuthorTransformer) RenderQueryResponse(_ context.Context, entities []Author) (httpserver.Response, error) {\n	return httpserver.NewJsonResponse(entities), nil\n}\n\n// snippet-end: transformer\n\n//go:embed config.dist.yml\nvar config []byte\n\n// snippet-start: main\nfunc main() {\n	application.New(\n		application.WithConfigBytes(config, "yml"),\n		application.WithLoggerHandlersFromConfig,\n		application.WithModuleFactory("http", httpserver.NewServer(\n			"default",\n			// snippet-start: crud handlers\n			func(ctx context.Context, config cfg.Config, logger log.Logger, router *httpserver.Router) error {\n				router.HandleWith(sqlh.WithCrudHandlers(1, "author", sqlh.SimpleTransformer(&AuthorTransformer{})))\n\n				return nil\n			},\n			// snippet-end: crud handlers\n		)),\n	).Run()\n}\n\n// snippet-end: main\n',a='package main\n\nimport (\n	"context"\n	_ "embed"\n	"fmt"\n	"time"\n\n	"github.com/gosoline-project/httpserver"\n	"github.com/gosoline-project/sqlc"\n	"github.com/gosoline-project/sqlh"\n	"github.com/gosoline-project/sqlr"\n	"github.com/justtrackio/gosoline/pkg/application"\n	"github.com/justtrackio/gosoline/pkg/cfg"\n	"github.com/justtrackio/gosoline/pkg/log"\n)\n\n// snippet-start: post entities\ntype Post struct {\n	sqlr.Entity[int64]\n	AuthorID int64  `db:"author_id"`\n	Title    string `db:"title"`\n	Body     string `db:"body"`\n	Status   string `db:"status"`\n}\n\ntype PostCreateInput struct {\n	Title string `json:"title" binding:"required"`\n	Body  string `json:"body" binding:"required"`\n}\n\ntype PostOutput struct {\n	Id        int64     `json:"id"`\n	AuthorID  int64     `json:"author_id"`\n	Title     string    `json:"title"`\n	Body      string    `json:"body"`\n	Status    string    `json:"status"`\n	CreatedAt time.Time `json:"created_at"`\n}\n\n// snippet-end: post entities\n\n// snippet-start: with tx handler\ntype PostHandler struct {\n}\n\nfunc NewPostHandler() httpserver.HandlerFactory[PostHandler] {\n	return func(ctx context.Context, config cfg.Config, logger log.Logger) (*PostHandler, error) {\n		return &PostHandler{}, nil\n	}\n}\n\n// snippet-end: with tx handler\n\n// snippet-start: bind tx handler\nfunc (h *PostHandler) HandleCreatePost(cttx sqlc.Tx, input *PostCreateInput) (httpserver.Response, error) {\n	// The transaction is automatically managed \u2014 commit on success, rollback on error.\n	// Use cttx.Q() to execute queries within the transaction scope.\n\n	post := &Post{\n		Title:  input.Title,\n		Body:   input.Body,\n		Status: "draft",\n	}\n\n	_, err := cttx.Q().Into("posts").Records(post).Exec(cttx)\n	if err != nil {\n		return nil, fmt.Errorf("failed to create post: %w", err)\n	}\n\n	return httpserver.NewJsonResponse(post), nil\n}\n\n// snippet-end: bind tx handler\n\n// snippet-start: bind tx no input\nfunc (h *PostHandler) HandleReadPost(cttx sqlc.Tx) (httpserver.Response, error) {\n	// BindTxN is used when no request body input is needed.\n	// The transaction is still available for database operations.\n\n	var posts []Post\n	err := cttx.Q().From("posts").Where(sqlc.Col("status").Eq("draft")).Select(cttx, &posts)\n	if err != nil {\n		return nil, fmt.Errorf("failed to query posts: %w", err)\n	}\n\n	return httpserver.NewJsonResponse(posts), nil\n}\n\n// snippet-end: bind tx no input\n\n//go:embed config.dist.yml\nvar config []byte\n\n// snippet-start: main\nfunc main() {\n	application.New(\n		application.WithConfigBytes(config, "yml"),\n		application.WithLoggerHandlersFromConfig,\n		application.WithModuleFactory("http", httpserver.NewServer(\n			"default",\n			// snippet-start: with tx register\n			func(ctx context.Context, config cfg.Config, logger log.Logger, router *httpserver.Router) error {\n				router.HandleWith(sqlh.WithTx(NewPostHandler(), func(router *httpserver.Router, handler *PostHandler) {\n					router.POST("/v1/authors/:id/posts", sqlh.BindTx(handler.HandleCreatePost))\n					router.GET("/v1/posts/:id", sqlh.BindTxN(handler.HandleReadPost))\n				}))\n\n				return nil\n			},\n			// snippet-end: with tx register\n		)),\n	).Run()\n}\n\n// snippet-end: main\n',l='package main\n\nimport (\n	"context"\n	"time"\n\n	"github.com/gosoline-project/httpserver"\n	"github.com/gosoline-project/sqlh"\n	"github.com/gosoline-project/sqlr"\n)\n\n// snippet-start: types\ntype (\n	UserCreateInput struct {\n		Name string `json:"name"`\n	}\n	UserUpdateInput struct {\n		Name string `json:"name"`\n	}\n	User struct {\n		sqlr.Entity[int]\n		Name string\n	}\n	UserOutput struct {\n		Id        int       `json:"id"`\n		Name      string    `json:"name"`\n		CreatedAt time.Time `json:"created_at"`\n		UpdatedAt time.Time `json:"updated_at"`\n	}\n)\n\n// snippet-end: types\n\n// snippet-start: crud\nfunc NewUserCrud() httpserver.RegisterFactoryFunc {\n	return sqlh.WithCrudHandlers(0, "user", sqlh.NewJsonResultsTransformer(&UserTransformer{}))\n}\n\n// snippet-end: crud\n\nvar _ sqlh.JsonResultsTransformer[int, User, UserCreateInput, UserUpdateInput] = (*UserTransformer)(nil)\n\n// snippet-start: transformer\ntype UserTransformer struct{}\n\nfunc (t *UserTransformer) TransformCreateInput(ctx context.Context, input *UserCreateInput) (*User, error) {\n	return &User{\n		Name: input.Name,\n	}, nil\n}\n\nfunc (t *UserTransformer) TransformUpdateInput(ctx context.Context, user *User, input *UserUpdateInput) (*User, error) {\n	user.Name = input.Name\n\n	return user, nil\n}\n\nfunc (t *UserTransformer) TransformOutput(ctx context.Context, user *User) (any, error) {\n	return UserOutput{\n		Id:        user.Id,\n		Name:      user.Name,\n		CreatedAt: user.CreatedAt,\n		UpdatedAt: user.UpdatedAt,\n	}, nil\n}\n\n// snippet-end: transformer\n',c={sidebar_position:3,title:"sqlh - SQL HTTP Handlers"},h,p={},u=[{value:"Getting Started",id:"getting-started",level:2},{value:"Configuration",id:"configuration",level:2},{value:"CRUD Handlers",id:"crud-handlers",level:2},{value:"Defining Entities",id:"defining-entities",level:3},{value:"Input Types",id:"input-types",level:3},{value:"Implementing the Transformer",id:"implementing-the-transformer",level:3},{value:"Registering CRUD Handlers",id:"registering-crud-handlers",level:3},{value:"Generated Endpoints",id:"generated-endpoints",level:3},{value:"Query with JSON Filter",id:"query-with-json-filter",level:3},{value:"Wiring into the Application",id:"wiring-into-the-application",level:3},{value:"Customizing Output Transformers",id:"customizing-output-transformers",level:2},{value:"JsonResultsTransformer",id:"jsonresultstransformer",level:3},{value:"Wiring Transformers",id:"wiring-transformers",level:3},{value:"Transaction Middleware",id:"transaction-middleware",level:2},{value:"Setting Up WithTx",id:"setting-up-withtx",level:3},{value:"Transaction Binding Helpers",id:"transaction-binding-helpers",level:3},{value:"BindTx \u2014 With Input",id:"bindtx--with-input",level:4},{value:"BindTxN \u2014 No Input",id:"bindtxn--no-input",level:4},{value:"BindTxR / BindTxNR \u2014 With Raw Request",id:"bindtxr--bindtxnr--with-raw-request",level:4},{value:"Wiring into the Application",id:"wiring-into-the-application-1",level:3},{value:"Summary of Binding Functions",id:"summary-of-binding-functions",level:3}];function x(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"sqlh"})," package exposes database entities as REST API endpoints. Built on top of ",(0,s.jsx)(n.a,{href:"/docs/how-to/databases-sql/sqlr",children:(0,s.jsx)(n.code,{children:"sqlr"})})," and ",(0,s.jsx)(n.a,{href:"/docs/how-to/databases-sql/sqlc",children:(0,s.jsx)(n.code,{children:"sqlc"})}),", it provides automatic CRUD handler generation, a transformer pattern for input/output mapping, and transaction middleware for wrapping HTTP requests in database transactions."]}),"\n",(0,s.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,s.jsx)(n.p,{children:"Add the dependency to your Go module:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"go get github.com/gosoline-project/sqlh@v0.2.1\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then import the package in your Go code:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'import "github.com/gosoline-project/sqlh"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"sqlh"})," package requires both an HTTP server and a database client. Configure them under the ",(0,s.jsx)(n.code,{children:"httpserver"})," and ",(0,s.jsx)(n.code,{children:"sqlc"})," keys respectively:"]}),"\n",(0,s.jsx)(d.N,{title:"config.dist.yml",language:"yaml",snippet:"config",children:"env: dev\n\napp_project: gosoline\napp_family: docs\napp_group: database-sql\napp_name: sqlh-crud\n\nlog:\n  handlers:\n    main:\n      level: debug\n\n# snippet-start: config\nhttpserver:\n  default:\n    port: 8080\n    mode: release\n\nsqlc:\n  default:\n    driver: mysql\n    uri:\n      host: 127.0.0.1\n      port: 3306\n      user: root\n      password: gosoline\n      database: blog\n    migrations:\n      enabled: true\n      reset: true\n      path: migrations\n# snippet-end: config\n"}),"\n",(0,s.jsxs)(n.p,{children:["The HTTP server configuration is described in the httpserver documentation. The database configuration follows the same format described in the ",(0,s.jsx)(n.a,{href:"/docs/how-to/databases-sql/sqlc#configuration",children:"sqlc documentation"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"crud-handlers",children:"CRUD Handlers"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"WithCrudHandlers"})," function generates a complete set of REST endpoints for an entity. It connects an ",(0,s.jsx)(n.code,{children:"sqlr"})," repository with a transformer to handle input/output mapping."]}),"\n",(0,s.jsx)(n.h3,{id:"defining-entities",children:"Defining Entities"}),"\n",(0,s.jsxs)(n.p,{children:["Entities use the same ",(0,s.jsx)(n.code,{children:"sqlr.Entity"})," base struct described in the ",(0,s.jsx)(n.a,{href:"/docs/how-to/databases-sql/sqlr#defining-entities",children:"sqlr documentation"}),":"]}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"entities",children:o}),"\n",(0,s.jsx)(n.h3,{id:"input-types",children:"Input Types"}),"\n",(0,s.jsx)(n.p,{children:"Define separate types for create and update input. These decouple the HTTP API from the database entity:"}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"input output",children:o}),"\n",(0,s.jsx)(n.p,{children:"Using separate input types lets you:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Validate input with ",(0,s.jsx)(n.code,{children:"binding"})," tags (e.g., ",(0,s.jsx)(n.code,{children:'binding:"required"'}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Exclude internal fields (like ",(0,s.jsx)(n.code,{children:"Id"})," or ",(0,s.jsx)(n.code,{children:"CreatedAt"}),") from create/update payloads"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"implementing-the-transformer",children:"Implementing the Transformer"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"Transformer[K, E, IC, IU]"})," interface converts between input types and entity types, and controls how responses are rendered. Implement ",(0,s.jsx)(n.code,{children:"TransformCreateInput"}),", ",(0,s.jsx)(n.code,{children:"TransformUpdateInput"}),", ",(0,s.jsx)(n.code,{children:"RenderEntityResponse"}),", and ",(0,s.jsx)(n.code,{children:"RenderQueryResponse"}),":"]}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"transformer",children:o}),"\n",(0,s.jsx)(n.p,{children:"The type parameters are:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"K"})}),(0,s.jsxs)(n.td,{children:["Primary key type (e.g., ",(0,s.jsx)(n.code,{children:"int64"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"E"})}),(0,s.jsxs)(n.td,{children:["Entity type (e.g., ",(0,s.jsx)(n.code,{children:"Author"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IC"})}),(0,s.jsxs)(n.td,{children:["Create input type (e.g., ",(0,s.jsx)(n.code,{children:"AuthorCreateInput"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IU"})}),(0,s.jsxs)(n.td,{children:["Update input type (e.g., ",(0,s.jsx)(n.code,{children:"AuthorUpdateInput"}),")"]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The interface requires four methods:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Method"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TransformCreateInput"})}),(0,s.jsx)(n.td,{children:"Converts a create input DTO into a new entity"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TransformUpdateInput"})}),(0,s.jsx)(n.td,{children:"Merges an update input DTO into an existing entity"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RenderEntityResponse"})}),(0,s.jsxs)(n.td,{children:["Serialises a single entity into an ",(0,s.jsx)(n.code,{children:"httpserver.Response"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RenderQueryResponse"})}),(0,s.jsxs)(n.td,{children:["Serialises a slice of entities into an ",(0,s.jsx)(n.code,{children:"httpserver.Response"})]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["In the simple case above, ",(0,s.jsx)(n.code,{children:"RenderEntityResponse"})," and ",(0,s.jsx)(n.code,{children:"RenderQueryResponse"})," return the entity directly as JSON. See ",(0,s.jsx)(n.a,{href:"#customizing-output-transformers",children:"Customizing Output Transformers"})," for approaches when you need a separate output shape."]}),"\n",(0,s.jsx)(n.h3,{id:"registering-crud-handlers",children:"Registering CRUD Handlers"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"WithCrudHandlers"})," to generate all endpoints and register them with the HTTP server:"]}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"crud handlers",children:o}),"\n",(0,s.jsx)(n.p,{children:"The arguments are:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Argument"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"version"})}),(0,s.jsxs)(n.td,{children:["API version number, used in the URL path (e.g., ",(0,s.jsx)(n.code,{children:"1"})," produces ",(0,s.jsx)(n.code,{children:"/v1/..."}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"entityName"})}),(0,s.jsxs)(n.td,{children:["Singular entity name for the URL path (e.g., ",(0,s.jsx)(n.code,{children:'"author"'}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"transformerFactory"})}),(0,s.jsx)(n.td,{children:"Factory that creates the transformer instance"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"generated-endpoints",children:"Generated Endpoints"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"WithCrudHandlers"})," registers five endpoints:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Method"}),(0,s.jsx)(n.th,{children:"Path"}),(0,s.jsx)(n.th,{children:"Handler"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/v{n}/{entity}"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HandleCreate"})}),(0,s.jsxs)(n.td,{children:["Creates an entity from ",(0,s.jsx)(n.code,{children:"IC"})," input"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GET"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/v{n}/{entity}/:id"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HandleRead"})}),(0,s.jsx)(n.td,{children:"Reads a single entity by ID"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PUT"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/v{n}/{entity}/:id"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HandleUpdate"})}),(0,s.jsxs)(n.td,{children:["Updates an entity from ",(0,s.jsx)(n.code,{children:"IU"})," input"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DELETE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/v{n}/{entity}/:id"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HandleDelete"})}),(0,s.jsxs)(n.td,{children:["Deletes an entity by ID; returns ",(0,s.jsx)(n.code,{children:"204 No Content"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"POST"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/v{n}/{entities}"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HandleQuery"})}),(0,s.jsx)(n.td,{children:"Queries entities with a JSON filter"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["The query endpoint uses the ",(0,s.jsx)(n.strong,{children:"plural"})," form of the entity name (e.g., ",(0,s.jsx)(n.code,{children:'"author"'})," becomes ",(0,s.jsx)(n.code,{children:'"/v1/authors"'}),"). Pluralization is handled automatically."]}),"\n",(0,s.jsx)(n.h3,{id:"query-with-json-filter",children:"Query with JSON Filter"}),"\n",(0,s.jsxs)(n.p,{children:["The query endpoint accepts a JSON body with a ",(0,s.jsx)(n.code,{children:"filter"})," field that maps to ",(0,s.jsx)(n.code,{children:"sqlc.JsonFilter"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "filter": {\n    "column": "name",\n    "operator": "=",\n    "value": "Alice"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The filter is converted to an ",(0,s.jsx)(n.code,{children:"sqlc.Expression"})," and applied as a WHERE condition on the query. See the ",(0,s.jsx)(n.a,{href:"/docs/how-to/databases-sql/sqlc",children:"sqlc JSON filter documentation"})," for the full filter syntax."]}),"\n",(0,s.jsx)(n.h3,{id:"wiring-into-the-application",children:"Wiring into the Application"}),"\n",(0,s.jsxs)(n.p,{children:["Register handlers with the gosoline HTTP server using ",(0,s.jsx)(n.code,{children:"router.HandleWith()"}),":"]}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"main",children:o}),"\n",(0,s.jsx)(n.h2,{id:"customizing-output-transformers",children:"Customizing Output Transformers"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"Transformer"})," interface is the primary extension point for controlling how entities are serialised in API responses. Because it is a plain Go interface, a single implementation can be written once and reused across multiple entities \u2014 or shared as an internal library across services. This makes it straightforward to enforce consistent response shapes, pagination envelopes, or field-level access control in one place."]}),"\n",(0,s.jsx)(n.h3,{id:"jsonresultstransformer",children:"JsonResultsTransformer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"JsonResultsTransformer[K, E, IC, IU]"})," is a simplified variant of ",(0,s.jsx)(n.code,{children:"Transformer"})," for the common case where you want to map entities to a dedicated output type and return them as JSON, without needing to construct ",(0,s.jsx)(n.code,{children:"httpserver.Response"})," values manually. Implement three methods \u2014 ",(0,s.jsx)(n.code,{children:"TransformCreateInput"}),", ",(0,s.jsx)(n.code,{children:"TransformUpdateInput"}),", and a single ",(0,s.jsx)(n.code,{children:"TransformOutput"})," that converts one entity to any JSON-serialisable value \u2014 and pass the implementation to ",(0,s.jsx)(n.code,{children:"NewJSONResultsTransformer"}),". The wrapping of single and multi-entity responses into JSON is handled automatically:"]}),"\n",(0,s.jsx)(d.N,{title:"user_crud.go",language:"go",snippet:"types",children:l}),"\n",(0,s.jsx)(d.N,{title:"user_crud.go",language:"go",snippet:"transformer",children:l}),"\n",(0,s.jsx)(d.N,{title:"user_crud.go",language:"go",snippet:"crud",children:l}),"\n",(0,s.jsxs)(n.p,{children:["Because ",(0,s.jsx)(n.code,{children:"TransformOutput"})," receives a single entity, the same function is used for both single-entity and list responses \u2014 there is no duplication. Use the full ",(0,s.jsx)(n.code,{children:"Transformer"})," interface directly when you need control over HTTP status codes, headers, or non-JSON response bodies."]}),"\n",(0,s.jsx)(n.h3,{id:"wiring-transformers",children:"Wiring Transformers"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"sqlh.SimpleTransformer()"})," to wrap an already-constructed transformer into a factory when it has no startup dependencies:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"sqlh.SimpleTransformer[K, E, IC, IU](&MyTransformer{})\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For transformers that require configuration or other dependencies at startup, implement ",(0,s.jsx)(n.code,{children:"TransformerFactory"})," directly:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type TransformerFactory[K, E, IC, IU] func(ctx context.Context, config cfg.Config, logger log.Logger) (Transformer[K, E, IC, IU], error)\n"})}),"\n",(0,s.jsx)(n.p,{children:"This follows the standard gosoline factory pattern and gives the transformer access to the application config and logger during initialisation."}),"\n",(0,s.jsx)(n.h2,{id:"transaction-middleware",children:"Transaction Middleware"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"WithTx"})," function wraps a group of HTTP routes in a database transaction. Each request automatically begins a transaction before the handler runs, commits on success, and rolls back if any error occurs."]}),"\n",(0,s.jsx)(n.h3,{id:"setting-up-withtx",children:"Setting Up WithTx"}),"\n",(0,s.jsxs)(n.p,{children:["Create a handler struct with a factory function, then use ",(0,s.jsx)(n.code,{children:"WithTx"})," to register routes:"]}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"with tx handler",children:a}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"with tx register",children:a}),"\n",(0,s.jsxs)(n.p,{children:["Notice that the handler struct does not create or hold a repository. Instead of manually setting up database access, each handler receives an active ",(0,s.jsx)(n.code,{children:"sqlc.Tx"})," directly through the ",(0,s.jsx)(n.code,{children:"Bind*"})," helpers \u2014 the transaction is started automatically before the handler runs and committed or rolled back afterward."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"WithTx"})," takes two arguments:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Argument"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"handlerFactory"})}),(0,s.jsxs)(n.td,{children:["Factory that creates the handler struct (with access to ",(0,s.jsx)(n.code,{children:"config"})," and ",(0,s.jsx)(n.code,{children:"logger"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"register"})}),(0,s.jsx)(n.td,{children:"Function that registers routes on the router, receiving the handler instance"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The middleware:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Begins a transaction via ",(0,s.jsx)(n.code,{children:"sqlClient.BeginTx()"})," before each request"]}),"\n",(0,s.jsx)(n.li,{children:"Stores the transaction in the gin context"}),"\n",(0,s.jsx)(n.li,{children:"Calls the next handler"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Commits"})," if no errors occurred"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rolls back"})," if any handler in the chain added an error to the gin context"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"transaction-binding-helpers",children:"Transaction Binding Helpers"}),"\n",(0,s.jsxs)(n.p,{children:["Inside a ",(0,s.jsx)(n.code,{children:"WithTx"}),"-wrapped route group, use the ",(0,s.jsx)(n.code,{children:"BindTx"})," family of functions to extract the transaction and bind request input:"]}),"\n",(0,s.jsx)(n.h4,{id:"bindtx--with-input",children:"BindTx \u2014 With Input"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"BindTx"})," when the handler needs both the transaction and a parsed request body:"]}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"bind tx handler",children:a}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"BindTx"})," automatically:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Binds the request body to the input type ",(0,s.jsx)(n.code,{children:"I"})]}),"\n",(0,s.jsxs)(n.li,{children:["Extracts the ",(0,s.jsx)(n.code,{children:"sqlc.Tx"})," from the gin context"]}),"\n",(0,s.jsx)(n.li,{children:"Calls the handler with both"}),"\n",(0,s.jsx)(n.li,{children:"Writes the response"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"bindtxn--no-input",children:"BindTxN \u2014 No Input"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"BindTxN"})," when the handler only needs the transaction (no request body):"]}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"bind tx no input",children:a}),"\n",(0,s.jsxs)(n.p,{children:["Since ",(0,s.jsx)(n.code,{children:"sqlc.Tx"})," implements ",(0,s.jsx)(n.code,{children:"Querier"}),", you can pass it to ",(0,s.jsx)(n.code,{children:"WithClient()"})," on query builders to execute queries within the transaction."]}),"\n",(0,s.jsx)(n.h4,{id:"bindtxr--bindtxnr--with-raw-request",children:"BindTxR / BindTxNR \u2014 With Raw Request"}),"\n",(0,s.jsxs)(n.p,{children:["For handlers that need access to the raw ",(0,s.jsx)(n.code,{children:"*http.Request"})," (e.g., to read headers or query parameters), use the ",(0,s.jsx)(n.code,{children:"R"})," variants:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// With input + raw request\nsqlh.BindTxR(func(cttx sqlc.Tx, req *http.Request, input *MyInput) (httpserver.Response, error) {\n    userAgent := req.Header.Get("User-Agent")\n    // ...\n})\n\n// No input + raw request\nsqlh.BindTxNR(func(cttx sqlc.Tx, req *http.Request) (httpserver.Response, error) {\n    // ...\n})\n'})}),"\n",(0,s.jsx)(n.h3,{id:"wiring-into-the-application-1",children:"Wiring into the Application"}),"\n",(0,s.jsx)(d.N,{title:"main.go",language:"go",snippet:"main",children:a}),"\n",(0,s.jsx)(n.h3,{id:"summary-of-binding-functions",children:"Summary of Binding Functions"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Function"}),(0,s.jsx)(n.th,{children:"Input"}),(0,s.jsx)(n.th,{children:"Raw Request"}),(0,s.jsx)(n.th,{children:"Signature"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BindTx"})}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"func(cttx sqlc.Tx, input *I) (Response, error)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BindTxR"})}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"func(cttx sqlc.Tx, req *http.Request, input *I) (Response, error)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BindTxN"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"func(cttx sqlc.Tx) (Response, error)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BindTxNR"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"func(cttx sqlc.Tx, req *http.Request) (Response, error)"})})]})]})]})]})}function j(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(x,{...e})}):x(e)}},4490(e,n,t){t.d(n,{N:()=>y,v:()=>f});var r=t(4848);t(6540);var s=t(5875),i=t(1083),d=t(3773),o=t(5681),a=t(8055),l=t(6311),c=t(7625),h=t(5638),p=t(6645),u=t(1113),x=t(6582),j=t(7312),g=t(3941),m=t(6497);function f(){let{colorMode:e}=(0,g.G)(),n=(0,x.A)({palette:{mode:"dark"===e?"dark":"light"}});return(0,r.jsx)(j.A,{theme:n,children:(0,r.jsxs)(h.Ay,{container:!0,spacing:4,children:[(0,r.jsx)(h.Ay,{item:!0,xs:12,s:12,md:4,children:(0,r.jsxs)(s.A,{style:{height:"100%"},children:[(0,r.jsx)(d.A,{title:"HTTP Server",avatar:(0,r.jsx)(p.default,{}),titleTypographyProps:{variant:"h6"}}),(0,r.jsx)(o.A,{children:"Build REST web services with HTTP handling, caching, OAuth, and much more."}),(0,r.jsx)(i.A,{children:(0,r.jsx)(a.A,{size:"small",href:(0,m.Ay)("/category/http-server"),children:"Get started"})})]})}),(0,r.jsx)(h.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(s.A,{style:{height:"100%"},children:[(0,r.jsx)(d.A,{title:"Message Queues",avatar:(0,r.jsx)(l.default,{}),titleTypographyProps:{variant:"h6"}}),(0,r.jsx)(o.A,{children:"Process asynchronous messages from Kafka, Redis, or any other queuing or streaming system."}),(0,r.jsx)(i.A,{children:(0,r.jsx)(a.A,{size:"small",href:(0,m.Ay)("/quickstart/create-a-consumer"),children:"Get started"})})]})}),(0,r.jsx)(h.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(s.A,{style:{height:"100%"},children:[(0,r.jsx)(d.A,{title:"Kernel Module",avatar:(0,r.jsx)(c.default,{}),titleTypographyProps:{variant:"h6"}}),(0,r.jsx)(o.A,{children:"Implement a kernel module with which you can do anything, using gosoline's logging, configuration, and other solutions."}),(0,r.jsx)(i.A,{children:(0,r.jsx)(a.A,{size:"small",href:(0,m.Ay)("/quickstart/create-an-application"),children:"Get started"})})]})})]})})}function y({children:e,snippet:n,...t}){let s=e.replace(/\n$/,"");if(n){let e=RegExp(`(?://|#) snippet-start: ${n}s*
(.*)(?://|#) snippet-end: ${n}s*$`,"sm"),t=s.match(e);t&&(s=t[1])}for(s=s.split("\n").filter(function(e){return!RegExp("w*?(?://|#) snippet.*\n*?$","g").test(e)});s.length>0&&""===s[0].trim();)s=s.slice(1);for(;s.length>0&&""===s[s.length-1].trim();)s=s.slice(0,-1);let i=(s=(s=s.join("\n")).replace(/^\t+/gm,e=>"  ".repeat(e.length))).split("\n"),d=i.filter(e=>e.trim().length>0).reduce((e,n)=>Math.min(e,n.match(/^(\s*)/)[1].length),1/0);return d>0&&d!==1/0&&(s=i.map(e=>e.slice(d)).join("\n")),(0,r.jsx)(u.A,{...t,children:s})}}}]);