"use strict";(self.webpackChunkgosoline_docs=self.webpackChunkgosoline_docs||[]).push([["3937"],{4122(e,n,t){t.r(n),t.d(n,{metadata:()=>r,default:()=>x,frontMatter:()=>a,contentTitle:()=>l,toc:()=>h,assets:()=>c});var r=JSON.parse('{"id":"how-to/databases-sql/sqlc","title":"sqlc - SQL Client","description":"The sqlc package provides a fluent API for building and executing SQL queries against relational databases. It supports MySQL and PostgreSQL, and offers connection management, query building, and transaction handling.","source":"@site/docs/how-to/databases-sql/sqlc.mdx","sourceDirName":"how-to/databases-sql","slug":"/how-to/databases-sql/sqlc","permalink":"/docs/how-to/databases-sql/sqlc","draft":false,"unlisted":false,"editUrl":"https://github.com/gosoline-project/docs/tree/main/docs/how-to/databases-sql/sqlc.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"sqlc - SQL Client"},"sidebar":"docSidebar","previous":{"title":"Working with Relational Databases","permalink":"/docs/how-to/databases-sql/"},"next":{"title":"sqlr - SQL Repository","permalink":"/docs/how-to/databases-sql/sqlr"}}'),i=t(4848),s=t(8453),o=t(4490);let d='package main\n\nimport (\n	"context"\n	_ "embed"\n	"fmt"\n	"time"\n\n	"github.com/gosoline-project/sqlc"\n	"github.com/justtrackio/gosoline/pkg/application"\n	"github.com/justtrackio/gosoline/pkg/cfg"\n	"github.com/justtrackio/gosoline/pkg/kernel"\n	gosolineLog "github.com/justtrackio/gosoline/pkg/log"\n)\n\n// snippet-start: models\ntype Author struct {\n	Id        int64     `db:"id"`\n	Name      string    `db:"name"`\n	Email     string    `db:"email"`\n	CreatedAt time.Time `db:"created_at"`\n	UpdatedAt time.Time `db:"updated_at"`\n}\n\n// snippet-end: models\n\ntype Post struct {\n	Id        int64     `db:"id"`\n	AuthorId  int64     `db:"author_id"`\n	Title     string    `db:"title"`\n	Body      string    `db:"body"`\n	Status    string    `db:"status"`\n	CreatedAt time.Time `db:"created_at"`\n	UpdatedAt time.Time `db:"updated_at"`\n}\n\ntype Comment struct {\n	Id        int64     `db:"id"`\n	AuthorId  int64     `db:"author_id"`\n	PostId    int64     `db:"post_id"`\n	Body      string    `db:"body"`\n	CreatedAt time.Time `db:"created_at"`\n	UpdatedAt time.Time `db:"updated_at"`\n}\n\ntype Tag struct {\n	Id        int64     `db:"id"`\n	Name      string    `db:"name"`\n	CreatedAt time.Time `db:"created_at"`\n	UpdatedAt time.Time `db:"updated_at"`\n}\n\ntype PostWithAuthor struct {\n	Post\n	AuthorName  string `db:"author_name"`\n	AuthorEmail string `db:"author_email"`\n}\n\n//go:embed config.dist.yml\nvar config []byte\n\nfunc main() {\n	application.RunFunc(\n		func(ctx context.Context, config cfg.Config, logger gosolineLog.Logger) (kernel.ModuleRunFunc, error) {\n			// snippet-start: main\n			var err error\n			var client sqlc.Client\n\n			if client, err = sqlc.NewClient(ctx, config, logger, "default"); err != nil {\n				return nil, fmt.Errorf("failed to create sqlc client: %w", err)\n			}\n			// snippet-end: main\n\n			service := &BlogService{\n				client: client,\n			}\n\n			return func(ctx context.Context) error {\n				timestamp := time.Now().UnixNano()\n\n				alice, err := service.createAuthor(ctx, "Alice", fmt.Sprintf("alice-%d@mail.io", timestamp))\n				if err != nil {\n					return fmt.Errorf("failed to create author: %w", err)\n				}\n				logger.Info(ctx, "created author: %s (id=%d, email=%s)", alice.Name, alice.Id, alice.Email)\n\n				tags, err := service.createTags(ctx, []string{"golang", "sql", "tutorial"})\n				if err != nil {\n					return fmt.Errorf("failed to create tags: %w", err)\n				}\n				logger.Info(ctx, "created %d tags", len(tags))\n\n				bob, bobPost, err := service.createAuthorWithPost(ctx, "Bob", fmt.Sprintf("bob-%d@mail.io", timestamp), "Hello World", "My first post!")\n				if err != nil {\n					return fmt.Errorf("failed to create author with post: %w", err)\n				}\n				logger.Info(ctx, "created author with post: %s (author_id=%d, post_id=%d)", bob.Name, bob.Id, bobPost.Id)\n\n				bobPosts, err := service.queryPostsByAuthor(ctx, bob.Id)\n				if err != nil {\n					return fmt.Errorf("failed to query posts by author: %w", err)\n				}\n				logger.Info(ctx, "found %d posts by author %s", len(bobPosts), bob.Name)\n\n				updatedPost, err := service.updatePostStatus(ctx, bobPost.Id, "published")\n				if err != nil {\n					return fmt.Errorf("failed to update post status: %w", err)\n				}\n				logger.Info(ctx, "updated post %d status to: %s", updatedPost.Id, updatedPost.Status)\n\n				publishedPosts, err := service.queryPostsWithJoins(ctx)\n				if err != nil {\n					return fmt.Errorf("failed to query posts with joins: %w", err)\n				}\n				logger.Info(ctx, "found %d published posts with author info", len(publishedPosts))\n\n				comment, err := service.createComment(ctx, alice.Id, bobPost.Id, "Great post!")\n				if err != nil {\n					return fmt.Errorf("failed to create comment: %w", err)\n				}\n				logger.Info(ctx, "created comment %d on post %d", comment.Id, bobPost.Id)\n\n				if err = service.deleteComment(ctx, comment.Id); err != nil {\n					return fmt.Errorf("failed to delete comment: %w", err)\n				}\n				logger.Info(ctx, "deleted comment %d", comment.Id)\n\n				return nil\n			}, nil\n		},\n		application.WithConfigBytes(config, "yml"),\n	)\n}\n\n// snippet-start: service\ntype BlogService struct {\n	client sqlc.Client\n}\n\n// snippet-end: service\n\n// snippet-start: create author\nfunc (s *BlogService) createAuthor(ctx context.Context, name, email string) (*Author, error) {\n	author := &Author{\n		Name:  name,\n		Email: email,\n	}\n\n	result, err := s.client.Q().Into("authors").Records(author).Exec(ctx)\n	if err != nil {\n		return nil, fmt.Errorf("failed to insert author: %w", err)\n	}\n\n	id, err := result.LastInsertId()\n	if err != nil {\n		return nil, fmt.Errorf("failed to get last insert id: %w", err)\n	}\n\n	author.Id = id\n\n	return author, nil\n}\n\n// snippet-end: create author\n\n// snippet-start: create tags\nfunc (s *BlogService) createTags(ctx context.Context, names []string) ([]Tag, error) {\n	tags := make([]Tag, len(names))\n	for i, name := range names {\n		tags[i] = Tag{Name: name}\n	}\n\n	_, err := s.client.Q().Into("tags").Records(tags).Exec(ctx)\n	if err != nil {\n		return nil, fmt.Errorf("failed to insert tags: %w", err)\n	}\n\n	return tags, nil\n}\n\n// snippet-end: create tags\n\n// snippet-start: query posts\nfunc (s *BlogService) queryPostsByAuthor(ctx context.Context, authorId int64) ([]Post, error) {\n	var posts []Post\n\n	err := sqlc.From("posts").\n		WithClient(s.client).\n		Where(sqlc.Col("author_id").Eq(authorId)).\n		OrderBy("created_at DESC").\n		Select(ctx, &posts)\n	if err != nil {\n		return nil, fmt.Errorf("failed to query posts: %w", err)\n	}\n\n	return posts, nil\n}\n\n// snippet-end: query posts\n\n// snippet-start: query joins\nfunc (s *BlogService) queryPostsWithJoins(ctx context.Context) ([]PostWithAuthor, error) {\n	var results []PostWithAuthor\n\n	err := sqlc.From("posts").As("p").\n		Columns("p.id", "p.author_id", "p.title", "p.body", "p.status", "p.created_at", "p.updated_at").\n		LeftJoin("authors").As("a").On("p.author_id = a.id").\n		Columns(\n			sqlc.Col("a.name").As("author_name"),\n			sqlc.Col("a.email").As("author_email"),\n		).\n		Where(sqlc.Col("p.status").Eq("published")).\n		OrderBy("p.created_at DESC").\n		WithClient(s.client).\n		Select(ctx, &results)\n	if err != nil {\n		return nil, fmt.Errorf("failed to query posts with joins: %w", err)\n	}\n\n	return results, nil\n}\n\n// snippet-end: query joins\n\n// snippet-start: update\nfunc (s *BlogService) updatePostStatus(ctx context.Context, postId int64, status string) (*Post, error) {\n	result, err := sqlc.Update("posts").\n		WithClient(s.client).\n		Set("status", status).\n		Where(sqlc.Col("id").Eq(postId)).\n		Exec(ctx)\n	if err != nil {\n		return nil, fmt.Errorf("failed to update post: %w", err)\n	}\n\n	rowsAffected, err := result.RowsAffected()\n	if err != nil {\n		return nil, fmt.Errorf("failed to get rows affected: %w", err)\n	}\n\n	if rowsAffected == 0 {\n		return nil, fmt.Errorf("no post found with id %d", postId)\n	}\n\n	var post Post\n	err = sqlc.From("posts").\n		WithClient(s.client).\n		Where(sqlc.Col("id").Eq(postId)).\n		Get(ctx, &post)\n	if err != nil {\n		return nil, fmt.Errorf("failed to get updated post: %w", err)\n	}\n\n	return &post, nil\n}\n\n// snippet-end: update\n\n// snippet-start: transaction\nfunc (s *BlogService) createAuthorWithPost(ctx context.Context, authorName, authorEmail, postTitle, postBody string) (*Author, *Post, error) {\n	var author *Author\n	var post *Post\n\n	err := s.client.WithTx(ctx, func(tx sqlc.Tx) error {\n		author = &Author{\n			Name:  authorName,\n			Email: authorEmail,\n		}\n\n		result, err := tx.Q().Into("authors").Records(author).Exec(ctx)\n		if err != nil {\n			return fmt.Errorf("failed to insert author: %w", err)\n		}\n\n		authorId, err := result.LastInsertId()\n		if err != nil {\n			return fmt.Errorf("failed to get last insert id: %w", err)\n		}\n		author.Id = authorId\n\n		post = &Post{\n			AuthorId: authorId,\n			Title:    postTitle,\n			Body:     postBody,\n			Status:   "draft",\n		}\n\n		result, err = tx.Q().Into("posts").Records(post).Exec(ctx)\n		if err != nil {\n			return fmt.Errorf("failed to insert post: %w", err)\n		}\n\n		postId, err := result.LastInsertId()\n		if err != nil {\n			return fmt.Errorf("failed to get last insert id: %w", err)\n		}\n		post.Id = postId\n\n		return nil\n	})\n	if err != nil {\n		return nil, nil, err\n	}\n\n	return author, post, nil\n}\n\n// snippet-end: transaction\n\n// snippet-start: delete\nfunc (s *BlogService) deleteComment(ctx context.Context, commentId int64) error {\n	result, err := sqlc.Delete("comments").\n		WithClient(s.client).\n		Where(sqlc.Col("id").Eq(commentId)).\n		Exec(ctx)\n	if err != nil {\n		return fmt.Errorf("failed to delete comment: %w", err)\n	}\n\n	rowsAffected, err := result.RowsAffected()\n	if err != nil {\n		return fmt.Errorf("failed to get rows affected: %w", err)\n	}\n\n	if rowsAffected == 0 {\n		return fmt.Errorf("no comment found with id %d", commentId)\n	}\n\n	return nil\n}\n\n// snippet-end: delete\n\n// snippet-start: create comment\nfunc (s *BlogService) createComment(ctx context.Context, authorId, postId int64, body string) (*Comment, error) {\n	comment := &Comment{\n		AuthorId: authorId,\n		PostId:   postId,\n		Body:     body,\n	}\n\n	result, err := s.client.Q().Into("comments").Records(comment).Exec(ctx)\n	if err != nil {\n		return nil, fmt.Errorf("failed to insert comment: %w", err)\n	}\n\n	id, err := result.LastInsertId()\n	if err != nil {\n		return nil, fmt.Errorf("failed to get last insert id: %w", err)\n	}\n\n	comment.Id = id\n\n	return comment, nil\n}\n\n// snippet-end: create comment\n',a={sidebar_position:1,title:"sqlc - SQL Client"},l,c={},h=[{value:"Getting Started",id:"getting-started",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Connection Settings",id:"connection-settings",level:3},{value:"Migrations",id:"migrations",level:2},{value:"Enabling Migrations",id:"enabling-migrations",level:3},{value:"Migration Settings",id:"migration-settings",level:3},{value:"Migration Files",id:"migration-files",level:3},{value:"Creating the Client",id:"creating-the-client",level:2},{value:"Data Models",id:"data-models",level:2},{value:"INSERT Operations",id:"insert-operations",level:2},{value:"Single Record",id:"single-record",level:3},{value:"Bulk Insert",id:"bulk-insert",level:3},{value:"Query Operations",id:"query-operations",level:2},{value:"Simple Queries",id:"simple-queries",level:3},{value:"Queries with JOINs",id:"queries-with-joins",level:3},{value:"UPDATE Operations",id:"update-operations",level:2},{value:"DELETE Operations",id:"delete-operations",level:2},{value:"Transactions",id:"transactions",level:2}];function u(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"sqlc"})," package provides a fluent API for building and executing SQL queries against relational databases. It supports MySQL and PostgreSQL, and offers connection management, query building, and transaction handling."]}),"\n",(0,i.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsx)(n.p,{children:"Add the dependency to your Go module:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"go get github.com/gosoline-project/sqlc@v0.1.0\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then import the package in your Go code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'import "github.com/gosoline-project/sqlc"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["A gosoline application can have ",(0,i.jsxs)(n.strong,{children:["multiple ",(0,i.jsx)(n.code,{children:"sqlc"})," clients"]}),", each identified by a unique name (e.g., ",(0,i.jsx)(n.code,{children:"default"}),", ",(0,i.jsx)(n.code,{children:"analytics"}),", ",(0,i.jsx)(n.code,{children:"readonly"}),"). Every client you intend to use ",(0,i.jsx)(n.strong,{children:"must be configured before use"})," \u2014 attempting to create a client without a matching configuration entry will result in an error at startup."]}),"\n",(0,i.jsxs)(n.p,{children:["Configure database connections under the ",(0,i.jsx)(n.code,{children:"sqlc"})," key in your configuration file, with each connection name as a sub-key:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sqlc:\n  default:       # primary database\n    # ...\n  analytics:     # separate analytics database\n    # ...\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each connection requires driver and connection details as shown below:"}),"\n",(0,i.jsx)(o.N,{title:"config.dist.yml",language:"yaml",snippet:"config",children:"env: dev\n\napp_project: gosoline\napp_family: docs\napp_group: database-sql\napp_name: sqlc\n\nlog:\n  handlers:\n    main:\n      level: debug\n\n# snippet-start: config\nsqlc:\n  default:\n    driver: mysql\n    uri:\n      host: 127.0.0.1\n      port: 3306\n      user: root\n      password: gosoline\n      database: blog\n    migrations:\n      enabled: true\n      path: migrations\n# snippet-end: config\n"}),"\n",(0,i.jsx)(n.h3,{id:"connection-settings",children:"Connection Settings"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Setting"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Default"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"driver"})}),(0,i.jsxs)(n.td,{children:["Database driver (",(0,i.jsx)(n.code,{children:"mysql"})," or ",(0,i.jsx)(n.code,{children:"postgres"}),")"]}),(0,i.jsx)(n.td,{children:"Required"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uri.host"})}),(0,i.jsx)(n.td,{children:"Database host"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"localhost"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uri.port"})}),(0,i.jsx)(n.td,{children:"Database port"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"3306"})," (MySQL) / ",(0,i.jsx)(n.code,{children:"5432"})," (PostgreSQL)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uri.user"})}),(0,i.jsx)(n.td,{children:"Database user"}),(0,i.jsx)(n.td,{children:"Required"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uri.password"})}),(0,i.jsx)(n.td,{children:"Database password"}),(0,i.jsx)(n.td,{children:"Required"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uri.database"})}),(0,i.jsx)(n.td,{children:"Database name"}),(0,i.jsx)(n.td,{children:"Required"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"charset"})}),(0,i.jsx)(n.td,{children:"Character set"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"utf8mb4"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"max_open_connections"})}),(0,i.jsx)(n.td,{children:"Maximum open connections"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"0"})," (unlimited)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"max_idle_connections"})}),(0,i.jsx)(n.td,{children:"Maximum idle connections"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"2"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"connection_max_lifetime"})}),(0,i.jsx)(n.td,{children:"Maximum connection lifetime"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"120s"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"connection_max_idletime"})}),(0,i.jsx)(n.td,{children:"Maximum idle time"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"120s"})})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"migrations",children:"Migrations"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"sqlc"})," package can automatically run database migrations when the client is created. It uses ",(0,i.jsx)(n.a,{href:"https://github.com/pressly/goose",children:"goose"})," as the default migration provider."]}),"\n",(0,i.jsx)(n.h3,{id:"enabling-migrations",children:"Enabling Migrations"}),"\n",(0,i.jsx)(n.p,{children:"Add migration settings to your database configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sqlc:\n  default:\n    migrations:\n      enabled: true\n      path: migrations\n"})}),"\n",(0,i.jsx)(n.h3,{id:"migration-settings",children:"Migration Settings"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Setting"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Default"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"enabled"})}),(0,i.jsx)(n.td,{children:"Run migrations automatically"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"path"})}),(0,i.jsx)(n.td,{children:"Path to migration files"}),(0,i.jsx)(n.td,{children:"Required if enabled"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"provider"})}),(0,i.jsx)(n.td,{children:"Migration provider"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"goose"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"reset"})}),(0,i.jsx)(n.td,{children:"Drop and recreate database before migrations"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"prefixed_tables"})}),(0,i.jsx)(n.td,{children:"Prefix tables with application name"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"migration-files",children:"Migration Files"}),"\n",(0,i.jsx)(n.p,{children:"Create migration files in the specified path using the goose format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- +goose Up\nCREATE TABLE authors (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    email VARCHAR(255) NOT NULL,\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n);\n\n-- +goose Down\nDROP TABLE authors;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"reset: true"})," option is useful for development - it drops and recreates the database before running migrations, ensuring a clean state."]}),"\n",(0,i.jsx)(n.h2,{id:"creating-the-client",children:"Creating the Client"}),"\n",(0,i.jsxs)(n.p,{children:["Create a client using ",(0,i.jsx)(n.code,{children:"sqlc.NewClient()"})," within a gosoline application. The client reads configuration from the specified connection name."]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"main",children:d}),"\n",(0,i.jsx)(n.p,{children:"The client provides:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Query Methods (from Querier interface):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Get(ctx, dest, query, args...)"})," - Executes a query returning at most one row, scans into dest"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Select(ctx, dest, query, args...)"})," - Executes a query and scans all rows into a slice"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Query(ctx, query, args...)"})," - Executes a query returning rows for iteration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"QueryRow(ctx, query, args...)"})," - Executes a query returning at most one row"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Exec(ctx, query, args...)"})," - Executes a query without returning rows (INSERT, UPDATE, DELETE)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"NamedExec(ctx, query, arg)"})," - Executes a named query using ",(0,i.jsx)(n.code,{children:":name"})," syntax from struct/map"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Prepare(ctx, query)"})," - Creates a prepared statement for later execution"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Transaction Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WithTx(ctx, fn, opts...)"})," - Executes a function within a transaction (auto commit/rollback)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"BeginTx(ctx, opts...)"})," - Starts a new transaction manually"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Other Methods:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Q()"})," - Returns a QueryBuilder for constructing SQL queries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Close()"})," - Closes the database connection"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"data-models",children:"Data Models"}),"\n",(0,i.jsxs)(n.p,{children:["Define struct types that map to your database tables using ",(0,i.jsx)(n.code,{children:"db"})," struct tags:"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"models",children:d}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"db"})," tag specifies the column name. Create composite structs for join results by embedding base types and adding additional fields."]}),"\n",(0,i.jsx)(n.h2,{id:"insert-operations",children:"INSERT Operations"}),"\n",(0,i.jsx)(n.h3,{id:"single-record",children:"Single Record"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"Into()"})," to create an INSERT builder, then ",(0,i.jsx)(n.code,{children:"Records()"})," to pass a struct:"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"create author",children:d}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Exec()"})," method returns a ",(0,i.jsx)(n.code,{children:"Result"})," with ",(0,i.jsx)(n.code,{children:"LastInsertId()"})," and ",(0,i.jsx)(n.code,{children:"RowsAffected()"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"bulk-insert",children:"Bulk Insert"}),"\n",(0,i.jsxs)(n.p,{children:["Pass a slice of structs to ",(0,i.jsx)(n.code,{children:"Records()"})," for bulk insertion:"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"create tags",children:d}),"\n",(0,i.jsx)(n.h2,{id:"query-operations",children:"Query Operations"}),"\n",(0,i.jsx)(n.h3,{id:"simple-queries",children:"Simple Queries"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"From()"})," to create a SELECT builder. Chain methods like ",(0,i.jsx)(n.code,{children:"Where()"}),", ",(0,i.jsx)(n.code,{children:"OrderBy()"}),", and ",(0,i.jsx)(n.code,{children:"Limit()"}),":"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"query posts",children:d}),"\n",(0,i.jsx)(n.h3,{id:"queries-with-joins",children:"Queries with JOINs"}),"\n",(0,i.jsxs)(n.p,{children:["Build joins using ",(0,i.jsx)(n.code,{children:"LeftJoin()"}),", ",(0,i.jsx)(n.code,{children:"InnerJoin()"}),", ",(0,i.jsx)(n.code,{children:"RightJoin()"}),", etc. Each join returns a ",(0,i.jsx)(n.code,{children:"JoinBuilder"})," that must be finalized with ",(0,i.jsx)(n.code,{children:"On()"}),":"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"query joins",children:d}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"As()"})," for table aliases and column aliases. Call ",(0,i.jsx)(n.code,{children:"Columns()"})," before and after joins to specify which columns to select."]}),"\n",(0,i.jsx)(n.h2,{id:"update-operations",children:"UPDATE Operations"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"Update()"})," to create an UPDATE builder. Chain ",(0,i.jsx)(n.code,{children:"Set()"})," for column values and ",(0,i.jsx)(n.code,{children:"Where()"})," for conditions:"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"update",children:d}),"\n",(0,i.jsxs)(n.p,{children:["Multiple ",(0,i.jsx)(n.code,{children:"Set()"})," calls are combined in the UPDATE clause. Use ",(0,i.jsx)(n.code,{children:"SetExpr()"})," for SQL expressions:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'sqlc.Update("posts").\n    SetExpr("updated_at", "NOW()").\n    Set("status", "published")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"delete-operations",children:"DELETE Operations"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"Delete()"})," to create a DELETE builder with ",(0,i.jsx)(n.code,{children:"Where()"})," conditions:"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"delete",children:d}),"\n",(0,i.jsx)(n.h2,{id:"transactions",children:"Transactions"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"WithTx()"})," to execute multiple operations atomically. The transaction automatically commits on success or rolls back on error:"]}),"\n",(0,i.jsx)(o.N,{title:"main.go",language:"go",snippet:"transaction",children:d}),"\n",(0,i.jsxs)(n.p,{children:["Inside the transaction callback, use ",(0,i.jsx)(n.code,{children:"tx.Q()"})," instead of ",(0,i.jsx)(n.code,{children:"client.Q()"})," to execute queries within the transaction scope. If the callback returns an error, all changes are rolled back; if it returns ",(0,i.jsx)(n.code,{children:"nil"}),", changes are committed."]})]})}function x(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},4490(e,n,t){t.d(n,{N:()=>b,v:()=>f});var r=t(4848);t(6540);var i=t(5875),s=t(1083),o=t(3773),d=t(5681),a=t(8055),l=t(6311),c=t(7625),h=t(5638),u=t(6645),x=t(1113),p=t(6582),g=t(7312),m=t(3941),j=t(6497);function f(){let{colorMode:e}=(0,m.G)(),n=(0,p.A)({palette:{mode:"dark"===e?"dark":"light"}});return(0,r.jsx)(g.A,{theme:n,children:(0,r.jsxs)(h.Ay,{container:!0,spacing:4,children:[(0,r.jsx)(h.Ay,{item:!0,xs:12,s:12,md:4,children:(0,r.jsxs)(i.A,{style:{height:"100%"},children:[(0,r.jsx)(o.A,{title:"HTTP Server",avatar:(0,r.jsx)(u.default,{}),titleTypographyProps:{variant:"h6"}}),(0,r.jsx)(d.A,{children:"Build REST web services with HTTP handling, caching, OAuth, and much more."}),(0,r.jsx)(s.A,{children:(0,r.jsx)(a.A,{size:"small",href:(0,j.Ay)("/category/http-server"),children:"Get started"})})]})}),(0,r.jsx)(h.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(i.A,{style:{height:"100%"},children:[(0,r.jsx)(o.A,{title:"Message Queues",avatar:(0,r.jsx)(l.default,{}),titleTypographyProps:{variant:"h6"}}),(0,r.jsx)(d.A,{children:"Process asynchronous messages from Kafka, Redis, or any other queuing or streaming system."}),(0,r.jsx)(s.A,{children:(0,r.jsx)(a.A,{size:"small",href:(0,j.Ay)("/quickstart/create-a-consumer"),children:"Get started"})})]})}),(0,r.jsx)(h.Ay,{item:!0,xs:12,md:4,children:(0,r.jsxs)(i.A,{style:{height:"100%"},children:[(0,r.jsx)(o.A,{title:"Kernel Module",avatar:(0,r.jsx)(c.default,{}),titleTypographyProps:{variant:"h6"}}),(0,r.jsx)(d.A,{children:"Implement a kernel module with which you can do anything, using gosoline's logging, configuration, and other solutions."}),(0,r.jsx)(s.A,{children:(0,r.jsx)(a.A,{size:"small",href:(0,j.Ay)("/quickstart/create-an-application"),children:"Get started"})})]})})]})})}function b({children:e,snippet:n,...t}){let i=e.replace(/\n$/,"");if(n){let e=RegExp(`(?://|#) snippet-start: ${n}s*
(.*)(?://|#) snippet-end: ${n}s*$`,"sm"),t=i.match(e);t&&(i=t[1])}for(i=i.split("\n").filter(function(e){return!RegExp("w*?(?://|#) snippet.*\n*?$","g").test(e)});i.length>0&&""===i[0].trim();)i=i.slice(1);for(;i.length>0&&""===i[i.length-1].trim();)i=i.slice(0,-1);let s=(i=(i=i.join("\n")).replace(/^\t+/gm,e=>"  ".repeat(e.length))).split("\n"),o=s.filter(e=>e.trim().length>0).reduce((e,n)=>Math.min(e,n.match(/^(\s*)/)[1].length),1/0);return o>0&&o!==1/0&&(i=s.map(e=>e.slice(o)).join("\n")),(0,r.jsx)(x.A,{...t,children:i})}}}]);