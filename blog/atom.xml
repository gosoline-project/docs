<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://gosoline-project.github.io/docs/blog</id>
    <title>Gosoline Docs Blog</title>
    <updated>2026-02-19T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://gosoline-project.github.io/docs/blog"/>
    <subtitle>Gosoline Docs Blog</subtitle>
    <icon>https://gosoline-project.github.io/docs/img/logo-dark.png</icon>
    <entry>
        <title type="html"><![CDATA[Identity & Naming Patterns: Flexible, Configuration-Driven Resource Naming]]></title>
        <id>https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns</id>
        <link href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns"/>
        <updated>2026-02-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Managing cloud resources across multiple environments, teams, and services is hard enough without fighting your own naming conventions. Gosoline's old AppId model locked you into a fixed project/family/group hierarchy — useful in practice, but inflexible by design. This release replaces it with a tag-based Identity system and a unified naming pattern engine that gives you full control over how every resource is named, from a single config file.]]></summary>
        <content type="html"><![CDATA[<p>Managing cloud resources across multiple environments, teams, and services is hard enough without fighting your own naming conventions. Gosoline's old <code>AppId</code> model locked you into a fixed <code>project/family/group</code> hierarchy — useful in practice, but inflexible by design. This release replaces it with a tag-based <code>Identity</code> system and a unified naming pattern engine that gives you full control over how every resource is named, from a single config file.</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-changed-at-a-glance">What changed at a glance<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#what-changed-at-a-glance" class="hash-link" aria-label="Direct link to What changed at a glance" title="Direct link to What changed at a glance" translate="no">​</a></h2>
<ul>
<li class="">The fixed <code>AppId</code> fields (<code>project</code>, <code>family</code>, <code>group</code>) are replaced by a flexible <code>app.tags</code> map — define any keys your organization needs.</li>
<li class="">A new <strong>unified naming pattern engine</strong> controls the names of SQS queues, SNS topics, DynamoDB tables, Kinesis streams, Kafka topics, Redis keys, CloudWatch namespaces, Prometheus prefixes, and tracing service names — all from config.</li>
<li class=""><code>{app.namespace}</code> lets you define your naming hierarchy once and reference it everywhere.</li>
<li class=""><code>application.Default()</code> has been slimmed down from ~22 options to 7, making every capability an explicit opt-in.</li>
<li class=""><code>pkg/es/</code> (Elasticsearch) and <code>pkg/parquet/</code> have been removed.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-new-identity-model">The new Identity model<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#the-new-identity-model" class="hash-link" aria-label="Direct link to The new Identity model" title="Direct link to The new Identity model" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="before-and-after">Before and after<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#before-and-after" class="hash-link" aria-label="Direct link to Before and after" title="Direct link to Before and after" translate="no">​</a></h3>
<p>The old flat top-level config keys are replaced with a nested <code>app:</code> block:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Before</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">app_project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myproject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">app_family</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">app_group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">app_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># After</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"{app.tags.project}.{app.env}.{app.tags.family}.{app.tags.group}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myproject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">family</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> core</span><br></span></code></pre></div></div>
<p>If you set your config via environment variables, the keys change too:</p>
<table><thead><tr><th style="text-align:left">Old variable</th><th style="text-align:left">New variable</th></tr></thead><tbody><tr><td style="text-align:left"><code>APP_PROJECT</code></td><td style="text-align:left"><code>APP_TAGS_PROJECT</code></td></tr><tr><td style="text-align:left"><code>APP_FAMILY</code></td><td style="text-align:left"><code>APP_TAGS_FAMILY</code></td></tr><tr><td style="text-align:left"><code>APP_GROUP</code></td><td style="text-align:left"><code>APP_TAGS_GROUP</code></td></tr><tr><td style="text-align:left"><code>APP_NAME</code></td><td style="text-align:left"><code>APP_NAME</code> (unchanged)</td></tr><tr><td style="text-align:left"><code>ENV</code></td><td style="text-align:left"><code>APP_ENV</code></td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dynamic-tags">Dynamic tags<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#dynamic-tags" class="hash-link" aria-label="Direct link to Dynamic tags" title="Direct link to Dynamic tags" translate="no">​</a></h3>
<p>Tags are no longer limited to <code>project/family/group</code>. You can define any keys that make sense for your organization:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myproject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">team</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cost_center</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> engineering</span><br></span></code></pre></div></div>
<p>Tags are <strong>only required if your naming patterns reference them</strong> — a minimal setup with <code>{app.env}-{queueId}</code> needs no tags at all.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="naming-patterns-define-once-use-everywhere">Naming patterns: define once, use everywhere<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#naming-patterns-define-once-use-everywhere" class="hash-link" aria-label="Direct link to Naming patterns: define once, use everywhere" title="Direct link to Naming patterns: define once, use everywhere" translate="no">​</a></h2>
<p>Every resource gosoline manages has a configurable naming pattern. Patterns are plain strings with <code>{placeholder}</code> macros resolved from your Identity at startup.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-namespace-pattern">The namespace pattern<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#the-namespace-pattern" class="hash-link" aria-label="Direct link to The namespace pattern" title="Direct link to The namespace pattern" translate="no">​</a></h3>
<p><code>app.namespace</code> is the cornerstone of the new naming system. Define your hierarchy once, reference it everywhere:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"{app.tags.project}.{app.env}.{app.tags.family}.{app.tags.group}"</span><br></span></code></pre></div></div>
<p>When <code>{app.namespace}</code> appears in a resource pattern, the dots are replaced by that service's delimiter — <code>-</code> for most AWS services, <code>/</code> for CloudWatch, <code>_</code> for Prometheus. This means the same namespace definition produces correctly formatted names for every service automatically.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="concrete-example-sqs-queues">Concrete example: SQS queues<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#concrete-example-sqs-queues" class="hash-link" aria-label="Direct link to Concrete example: SQS queues" title="Direct link to Concrete example: SQS queues" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"{app.tags.project}.{app.env}.{app.tags.group}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">cloud</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">aws</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">sqs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">clients</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">naming</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">queue_pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"{app.namespace}-{queueId}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">queue_delimiter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-"</span><br></span></code></pre></div></div>
<table><thead><tr><th style="text-align:left">Queue ID in code</th><th style="text-align:left">Resolved queue name</th></tr></thead><tbody><tr><td style="text-align:left"><code>orders</code></td><td style="text-align:left"><code>logistics-production-platform-orders</code></td></tr><tr><td style="text-align:left"><code>shipments</code></td><td style="text-align:left"><code>logistics-production-platform-shipments</code></td></tr></tbody></table>
<p>Switching to <code>env: dev</code> automatically updates all queue names — no queue-specific config changes needed.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="strict-placeholder-validation">Strict placeholder validation<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#strict-placeholder-validation" class="hash-link" aria-label="Direct link to Strict placeholder validation" title="Direct link to Strict placeholder validation" translate="no">​</a></h3>
<p>Unknown placeholders in naming patterns now return an error at startup. A typo like <code>{app.tag.project}</code> (missing <code>s</code>) or a leftover legacy <code>{project}</code> is caught immediately rather than silently producing wrong resource names in production.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="full-pattern-reference">Full pattern reference<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#full-pattern-reference" class="hash-link" aria-label="Direct link to Full pattern reference" title="Direct link to Full pattern reference" translate="no">​</a></h3>
<p>For a complete list of all configurable patterns across every service, see the <a class="" href="https://gosoline-project.github.io/docs/reference/naming-patterns">Naming Patterns reference</a> and <a class="" href="https://gosoline-project.github.io/docs/fundamentals/naming-patterns">Naming Patterns fundamentals</a>.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="applicationdefault-slimmed-down"><code>application.Default()</code> slimmed down<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#applicationdefault-slimmed-down" class="hash-link" aria-label="Direct link to applicationdefault-slimmed-down" title="Direct link to applicationdefault-slimmed-down" translate="no">​</a></h2>
<p>Previously, <code>application.Default()</code> bundled ~22 options — health checks, metrics, tracing, profiling, Sentry, task runner, producer daemon, and more — whether your application needed them or not. A simple CLI tool or a lightweight worker ended up opting out of most of them, or unknowingly carrying capabilities it didn't use.</p>
<p><code>application.Default()</code> now ships only the essentials: config loading infrastructure and logger wiring. Everything else — health checks, metrics, tracing, profiling, stream infrastructure — is an explicit opt-in. You compose exactly the application you need:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// load config from file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithConfigFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"./config.dist.yml"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"yml"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// only the capabilities this service actually uses</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WithHttpHealthCheck</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WithMetrics</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WithTracing</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithModuleFactory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"my-module"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NewMyModule</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>A service that only needs config loading and logging needs nothing beyond the new defaults. A full-featured service adds exactly the options it requires — no hidden defaults to opt out of.</p>
<p>This pairs naturally with the new naming system: since tags are optional and <code>app.env</code> defaults to <code>dev</code> and <code>app.name</code> defaults to <code>gosoline</code>, a minimal application needs zero configuration to start. Getting something running no longer requires wiring up a full config file first.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="other-breaking-changes">Other breaking changes<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#other-breaking-changes" class="hash-link" aria-label="Direct link to Other breaking changes" title="Direct link to Other breaking changes" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="go-api">Go API<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#go-api" class="hash-link" aria-label="Direct link to Go API" title="Direct link to Go API" translate="no">​</a></h3>
<ul>
<li class=""><code>cfg.AppId</code> → <code>cfg.Identity</code>; <code>cfg.GetAppIdFromConfig()</code> → <code>cfg.GetAppIdentity()</code></li>
<li class=""><code>WithLoggerGroupTag</code> → <code>WithLoggerApplicationTag("group")</code>; <code>WithLoggerApplicationTag</code> → <code>WithLoggerApplicationName</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="config-key-renames">Config key renames<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#config-key-renames" class="hash-link" aria-label="Direct link to Config key renames" title="Direct link to Config key renames" translate="no">​</a></h3>
<p>Pattern keys have been renamed from the generic <code>naming.pattern</code> to descriptive, service-specific names: <code>naming.queue_pattern</code>, <code>naming.topic_pattern</code>, <code>naming.stream_pattern</code>, <code>naming.table_pattern</code>, etc. Each has an accompanying <code>naming.*_delimiter</code> setting.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="modelid-refactoring">ModelId refactoring<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#modelid-refactoring" class="hash-link" aria-label="Direct link to ModelId refactoring" title="Direct link to ModelId refactoring" translate="no">​</a></h3>
<p><code>mdl.ModelId</code> no longer has explicit hierarchy fields (<code>.Project</code>, <code>.Family</code>, <code>.Group</code>). Like <code>cfg.Identity</code>, it now uses a <code>.Tags</code> map:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Before</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelId </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> mdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ModelId</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-project"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Family</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">"my-family"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">"my-model"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// After</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelId </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> mdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ModelId</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-model"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"project"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"my-project"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"family"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">"my-family"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The string representation of a <code>ModelId</code> — used for message routing attributes and <code>mdlsub</code> publishers — is now configurable via <code>app.model_id.domain_pattern</code>. The model name is always appended automatically as the last dot-separated segment:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">model_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">domain_pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"{app.tags.project}.{app.env}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Result: myproject.production.myModel</span><br></span></code></pre></div></div>
<p>A few things to be aware of:</p>
<ul>
<li class="">The <code>{modelId}</code> placeholder is <strong>not</strong> used in this pattern — the model name is appended automatically.</li>
<li class="">If <code>domain_pattern</code> is not configured, calling <code>modelId.String()</code> will return an error.</li>
<li class="">When parsing a canonical model ID string back, each placeholder matches non-dot characters, and the model name is everything after the final dot. This means using non-dot delimiters (e.g. <code>{app.tags.project}-{app.env}</code>) is valid, but the last <code>.</code> in the full string always marks the boundary before the model name.</li>
</ul>
<p>See the <a class="" href="https://gosoline-project.github.io/docs/reference/naming-patterns#modelid-domain-pattern-canonical-ids">Naming Patterns reference</a> for the full rules and examples.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="removed-packages">Removed packages<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#removed-packages" class="hash-link" aria-label="Direct link to Removed packages" title="Direct link to Removed packages" translate="no">​</a></h3>
<ul>
<li class=""><strong><code>pkg/es/</code></strong> — Elasticsearch client integration</li>
<li class=""><strong><code>pkg/parquet/</code></strong> — Parquet file read/write support</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="migration-quick-start">Migration quick start<a href="https://gosoline-project.github.io/docs/blog/identity-and-naming-patterns#migration-quick-start" class="hash-link" aria-label="Direct link to Migration quick start" title="Direct link to Migration quick start" translate="no">​</a></h2>
<p>For full step-by-step instructions covering stream input/output config, <code>mdlsub</code> publishers, Go code changes, and per-service pattern updates, see the <a class="" href="https://gosoline-project.github.io/docs/migrations/app-identity-and-naming-patterns">migration guide</a>.</p>]]></content>
        <author>
            <name>Jan Kamieth</name>
            <uri>https://github.com/j4k4</uri>
        </author>
        <category label="identity" term="identity"/>
        <category label="naming" term="naming"/>
        <category label="configuration" term="configuration"/>
        <category label="breaking-changes" term="breaking-changes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Log Sampling in Go: Less Noise, More Debuggability]]></title>
        <id>https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging</id>
        <link href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging"/>
        <updated>2026-01-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[High-traffic services have a logging problem: the more successful traffic you handle, the more you pay to store and query logs that rarely matter. But if you turn logging down, you lose the context you need when something does break.]]></summary>
        <content type="html"><![CDATA[<p>High-traffic services have a logging problem: the more successful traffic you handle, the more you pay to store and query logs that rarely matter. But if you turn logging down, you lose the context you need when something <em>does</em> break.</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-traditional-log-sampling-isnt-enough">Why traditional log sampling isn’t enough<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#why-traditional-log-sampling-isnt-enough" class="hash-link" aria-label="Direct link to Why traditional log sampling isn’t enough" title="Direct link to Why traditional log sampling isn’t enough" translate="no">​</a></h2>
<p>Many production setups already try to reduce cost by doing <em>log pipeline sampling</em> in tools like Fluentd/Fluent Bit, Logstash, or the logging backend itself.</p>
<p>This approach usually looks like “drop X% of log lines” or “keep 1 out of N entries”, often applied uniformly across an application or per log level.</p>
<p>That can help with volume, but it has two fundamental drawbacks:</p>
<ul>
<li class=""><strong>No context-based sampling</strong>: pipeline sampling typically operates on individual log events. It doesn’t understand that a set of logs belong to the same HTTP request, stream message, or job run. You can easily end up keeping the exception log but dropping the ten lines that explain <em>why</em> it happened.</li>
<li class=""><strong>No fingers-crossed behavior</strong>: pipeline sampling drops data permanently. It can’t buffer the “boring but useful if it fails” debug logs and only emit them when a failure occurs.</li>
</ul>
<p>In other words: traditional sampling reduces cost, but it tends to reduce <em>debuggability</em> at the same time.</p>
<p>The goal of the feature set in this post is to reduce log volume while <strong>keeping failure context intact</strong>.</p>
<p>A good logging system should give you:</p>
<ul>
<li class="">Low log volume for routine success paths</li>
<li class="">Full, high-fidelity context for failures</li>
<li class="">A way to “turn up” verbosity for a small, controlled slice of traffic</li>
<li class="">Consistent behavior across HTTP requests, background jobs, and message consumers</li>
</ul>
<p>This post walks through two techniques that work especially well together:</p>
<ol>
<li class=""><strong>Sampling</strong> — make a consistent sampled/not-sampled decision and store it in <code>context.Context</code>.</li>
<li class=""><strong>Fingers-crossed logging</strong> — buffer logs and only flush them when an error occurs.</li>
</ol>
<p>The examples use gosoline (a Go framework for cloud microservices), but the patterns are transport-agnostic and apply to any Go service architecture.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-two-ideas">The two ideas<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#the-two-ideas" class="hash-link" aria-label="Direct link to The two ideas" title="Direct link to The two ideas" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-sampling-is-a-decision-carried-in-context">1) Sampling is a decision carried in context<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#1-sampling-is-a-decision-carried-in-context" class="hash-link" aria-label="Direct link to 1) Sampling is a decision carried in context" title="Direct link to 1) Sampling is a decision carried in context" translate="no">​</a></h3>
<p>Sampling isn’t “randomly drop log lines”. It’s a <em>decision about a unit of work</em>:</p>
<ul>
<li class="">Sampled: treat this request/message/job as “debuggable”, allow verbose logs</li>
<li class="">Not sampled: keep things quiet unless there is a failure</li>
</ul>
<p>The important part: store that decision in <code>context.Context</code>, so anything downstream can read it.</p>
<p>In gosoline, this lives in the <code>smplctx</code> package.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-fingers-crossed-logging-buffers-context-and-only-emits-on-failure">2) Fingers-crossed logging buffers context and only emits on failure<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#2-fingers-crossed-logging-buffers-context-and-only-emits-on-failure" class="hash-link" aria-label="Direct link to 2) Fingers-crossed logging buffers context and only emits on failure" title="Direct link to 2) Fingers-crossed logging buffers context and only emits on failure" translate="no">​</a></h3>
<p>“Fingers-crossed” logging means:</p>
<ul>
<li class="">Buffer <code>debug/info/warn</code> messages during a scope</li>
<li class="">If the scope ends successfully: discard the buffer</li>
<li class="">If an error happens: flush the full buffer (the story leading up to the error)</li>
</ul>
<p>That gives you rich “what happened before it failed?” context—without paying for it on every success.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-behavior-model-simple-mental-map">The behavior model (simple mental map)<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#the-behavior-model-simple-mental-map" class="hash-link" aria-label="Direct link to The behavior model (simple mental map)" title="Direct link to The behavior model (simple mental map)" translate="no">​</a></h2>
<p>Think in terms of <em>two</em> questions:</p>
<ol>
<li class="">Is this unit of work marked “sampled”?</li>
<li class="">Did it fail?</li>
</ol>
<p>If it’s sampled, you log as usual.
If it’s not sampled, you buffer; if it fails, you flush.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-enable-it-in-a-gosoline-service">How to enable it in a gosoline service<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#how-to-enable-it-in-a-gosoline-service" class="hash-link" aria-label="Direct link to How to enable it in a gosoline service" title="Direct link to How to enable it in a gosoline service" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-configure-sampling">How to configure sampling<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#how-to-configure-sampling" class="hash-link" aria-label="Direct link to How to configure sampling" title="Direct link to How to configure sampling" translate="no">​</a></h3>
<p>There are two separate things to set up:</p>
<ul>
<li class=""><strong>How decisions are made</strong> (strategies): controlled by config (<code>sampling.enabled</code>, <code>sampling.strategies</code>, and strategy-specific settings).</li>
<li class=""><strong>What gosoline does with that decision</strong> (behavior): enabled via an application option (next section).</li>
</ul>
<p>This separation is deliberate: it lets you define and tune your sampling strategies without changing code, while still keeping sampling-dependent behavior opt-in at the application wiring level.</p>
<p>Here’s a minimal config that enables sampling and selects strategies:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">sampling</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">strategies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tracing</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-enable-sampling-in-the-application">How to enable sampling in the application<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#how-to-enable-sampling-in-the-application" class="hash-link" aria-label="Direct link to How to enable sampling in the application" title="Direct link to How to enable sampling in the application" translate="no">​</a></h3>
<p>The config above only describes <strong>how to decide</strong> whether something should be sampled.</p>
<p>To actually <strong>activate sampling-aware behavior</strong> (fingers-crossed logging and sampling propagation across messages), enable it in the application wiring:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">WithSampling</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Why is this a separate switch?</p>
<ul>
<li class="">It keeps the behavior opt-in. Many services may want to create sampling decisions (e.g. for metrics or tracing consistency) without changing logging/stream behavior.</li>
<li class="">It lets you roll out safely: you can ship configs ahead of time, then enable the new behavior explicitly in code when you’re ready.</li>
</ul>
<p>What <code>app.WithSampling</code> does at runtime:</p>
<ul>
<li class=""><strong>Logger integration</strong>: enables sampling-aware logging so the logger can react to <code>sampled=true|false</code> on the context.</li>
<li class=""><strong>Stream integration</strong>: propagates the sampling decision as a message attribute so consumers can keep consistent behavior across service boundaries.</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="strategy-guide-how-strategies-decide">Strategy guide (how strategies decide)<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#strategy-guide-how-strategies-decide" class="hash-link" aria-label="Direct link to Strategy guide (how strategies decide)" title="Direct link to Strategy guide (how strategies decide)" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="tracing-follow-upstream-trace-sampling-x-ray--opentelemetry"><code>tracing</code>: follow upstream trace sampling (X-Ray / OpenTelemetry)<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#tracing-follow-upstream-trace-sampling-x-ray--opentelemetry" class="hash-link" aria-label="Direct link to tracing-follow-upstream-trace-sampling-x-ray--opentelemetry" title="Direct link to tracing-follow-upstream-trace-sampling-x-ray--opentelemetry" translate="no">​</a></h4>
<p>In modern setups, incoming requests often already carry a sampling decision as part of distributed tracing.</p>
<ul>
<li class=""><strong>AWS X-Ray</strong> propagates trace context via the <code>X-Amzn-Trace-Id</code> header. The header can include a sampling decision (for example, <code>Sampled=1</code>), indicating that this request should be traced.</li>
<li class=""><strong>OpenTelemetry</strong> commonly propagates trace context via the W3C <code>traceparent</code> header (and optionally <code>tracestate</code>). In W3C propagation, the <em>trace flags</em> include a “sampled” bit.</li>
</ul>
<p>The <code>tracing</code> sampling strategy reuses that existing decision:</p>
<ul>
<li class="">If there is valid tracing information on the context, gosoline treats the trace sampling flag as the source of truth.</li>
<li class="">This keeps logs and traces aligned: if a request is traced (sampled), you typically also want its logs to be available immediately and in higher detail.</li>
</ul>
<p>This is especially useful when your sampling decision is made upstream (e.g., an ingress, API gateway, or service mesh) and you want every downstream service to follow the same “sampled vs. not sampled” choice.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="probabilistic-guaranteed-baseline--extra-traffic"><code>probabilistic</code>: guaranteed baseline + extra traffic<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#probabilistic-guaranteed-baseline--extra-traffic" class="hash-link" aria-label="Direct link to probabilistic-guaranteed-baseline--extra-traffic" title="Direct link to probabilistic-guaranteed-baseline--extra-traffic" translate="no">​</a></h4>
<p>If you don’t have tracing (or don’t want to couple sampling to tracing), a probabilistic strategy is a good default.</p>
<p>It guarantees at least a small amount of sampled traffic per time window (so you always have some detailed examples), and then optionally samples additional requests at a configured percentage.</p>
<p>Configuration example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">sampling</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">strategies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> probabilistic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">settings</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">probabilistic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">fixed_sample_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">extra_rate_percentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><br></span></code></pre></div></div>
<p>Interpretation:</p>
<ul>
<li class="">guarantee at least <code>fixed_sample_count</code> sampled decisions per <code>interval</code></li>
<li class="">additionally sample <code>extra_rate_percentage</code>% of other traffic</li>
</ul>
<p>This is a nice operational compromise: you always have <em>some</em> detailed traffic, and you can raise/lower the extra percentage depending on cost and debugging needs.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multiple-strategies">multiple strategies<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#multiple-strategies" class="hash-link" aria-label="Direct link to multiple strategies" title="Direct link to multiple strategies" translate="no">​</a></h3>
<p>You can also combine multiple strategies. A common pattern is:</p>
<ul>
<li class="">Use <code>tracing</code> when trace context exists.</li>
<li class="">Fall back to <code>probabilistic</code> when there is no trace (so you still get a small, controlled amount of sampled traffic).</li>
</ul>
<p>Example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">sampling</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">strategies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> tracing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> probabilistic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">settings</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">probabilistic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">fixed_sample_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">extra_rate_percentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-the-sampling-decision-is-forwarded-downstream-in-stream-messages">How the sampling decision is forwarded downstream in stream messages<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#how-the-sampling-decision-is-forwarded-downstream-in-stream-messages" class="hash-link" aria-label="Direct link to How the sampling decision is forwarded downstream in stream messages" title="Direct link to How the sampling decision is forwarded downstream in stream messages" translate="no">​</a></h3>
<p>In real systems, the most painful sampling failures happen at service boundaries:</p>
<ul>
<li class="">Service A decides “this request is sampled” (maybe because tracing says so).</li>
<li class="">Service A publishes an event.</li>
<li class="">Service B consumes the event… and makes its <em>own</em> sampling decision.</li>
</ul>
<p>If Service B decides differently, you end up with inconsistent observability: a trace might exist for the end-to-end operation, but the logs are only high-fidelity in some of the services.</p>
<p>To avoid that, gosoline can <strong>propagate the sampling decision via stream message metadata</strong>.</p>
<p>When <code>app.WithSampling</code> is enabled, gosoline adds a default stream encode handler that:</p>
<ul>
<li class="">Reads the current sampling decision from the context.</li>
<li class="">Writes it to a message attribute named <code>sampled</code>.</li>
</ul>
<p>On the consumer side, gosoline restores that decision from the incoming message attribute and places it on the consumer’s <code>context.Context</code>. That restored decision should take precedence over locally configured strategies.</p>
<p>The effect is that a single upstream “sampled vs not sampled” choice (often driven by tracing) stays consistent across the entire chain of producers and consumers, without downstream services having to re-decide or accidentally choose differently.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-fingers-crossed-works-in-http-servers-and-stream-consumers">How fingers-crossed works in HTTP servers and stream consumers<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#how-fingers-crossed-works-in-http-servers-and-stream-consumers" class="hash-link" aria-label="Direct link to How fingers-crossed works in HTTP servers and stream consumers" title="Direct link to How fingers-crossed works in HTTP servers and stream consumers" translate="no">​</a></h2>
<p>Fingers-crossed is easiest to reason about if you think of it as <strong>request/message-scoped buffering</strong>:</p>
<ul>
<li class="">A scope provides a buffer “attached” to the <code>context.Context</code>.</li>
<li class="">While the scope is active and the context is <strong>not sampled</strong>, non-error log calls are collected in that buffer.</li>
<li class="">When a failure signal happens, the buffer is flushed in order, so you see the full lead-up.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="http-server-behavior">HTTP server behavior<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#http-server-behavior" class="hash-link" aria-label="Direct link to HTTP server behavior" title="Direct link to HTTP server behavior" translate="no">​</a></h3>
<p>In gosoline’s <code>httpserver</code>, the middleware chain is set up so that:</p>
<ol>
<li class="">A sampling decision is made early in the request lifecycle.</li>
<li class="">The logging middleware establishes a fingers-crossed scope for the request context.</li>
<li class="">At the end of the request, gosoline decides whether to flush based on the <strong>HTTP status code</strong>.</li>
</ol>
<p>What you get in practice:</p>
<ul>
<li class=""><strong>Sampled request</strong> (<code>sampled=true</code>): logs are written immediately (no buffering).</li>
<li class=""><strong>Not sampled request</strong> (<code>sampled=false</code>): non-error logs are buffered.</li>
<li class=""><strong>If an error is logged</strong>: the buffer is flushed immediately, so you get the lead-up right when the first error happens.</li>
<li class=""><strong>Otherwise, at the end of the request</strong>:<!-- -->
<ul>
<li class=""><strong>status &lt; 400</strong>: buffered logs are discarded (you don’t pay for successful traffic).</li>
<li class=""><strong>status &gt;= 400</strong>: buffered logs are flushed, giving you the debug trail for failed requests.</li>
</ul>
</li>
</ul>
<p>This makes failures “speak up” with context, without turning normal traffic noisy.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="stream-consumer-behavior">Stream consumer behavior<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#stream-consumer-behavior" class="hash-link" aria-label="Direct link to Stream consumer behavior" title="Direct link to Stream consumer behavior" translate="no">​</a></h3>
<p>Stream consumers don’t have an HTTP status code, so they need a different “failure signal”. In gosoline, the model is:</p>
<ul>
<li class="">Consumers restore the sampling decision from the incoming message (attribute <code>sampled</code>) when present.</li>
<li class="">When the context is <strong>not sampled</strong>, gosoline buffers non-error logs while processing the message.</li>
<li class="">The buffer is flushed when an <strong>error-level log</strong> happens, or when you explicitly call <code>log.FlushFingersCrossedScope(ctx)</code>.</li>
</ul>
<p>Practical implications:</p>
<ul>
<li class="">For a successful message, not-sampled logs stay quiet.</li>
<li class="">For a failing message, the error log causes the preceding buffered info/debug logs to be emitted as well.</li>
</ul>
<p>That gives you “quiet success, loud failure” behavior across both HTTP and messaging, while still keeping decisions consistent end-to-end.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-use-fingers-crossed-logging-manually-jobs-clis-workers">How to use “fingers-crossed” logging manually (jobs, CLIs, workers)<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#how-to-use-fingers-crossed-logging-manually-jobs-clis-workers" class="hash-link" aria-label="Direct link to How to use “fingers-crossed” logging manually (jobs, CLIs, workers)" title="Direct link to How to use “fingers-crossed” logging manually (jobs, CLIs, workers)" translate="no">​</a></h2>
<p>For non-HTTP code (CLI, cron job, custom worker), you can wrap work in a fingers-crossed scope:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ctx </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Background</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Mark this work as not sampled, to demonstrate buffering behavior.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> smplctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithSampling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> smplctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Sampling</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">Sampled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Create a buffer scope. Logs won’t emit immediately.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithFingersCrossedScope</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"starting job: %s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"details: %+v"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// When an error is logged, the buffer flushes.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doWork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"job failed: %w"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>If you want explicit control, you can flush manually:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FlushFingersCrossedScope</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-do-http-request-sampling-including-a-force-sample-override">How to do HTTP request sampling (including a “force sample” override)<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#how-to-do-http-request-sampling-including-a-force-sample-override" class="hash-link" aria-label="Direct link to How to do HTTP request sampling (including a “force sample” override)" title="Direct link to How to do HTTP request sampling (including a “force sample” override)" translate="no">​</a></h2>
<p>If you want a runnable example, see <a href="https://github.com/justtrackio/gosoline/tree/main/examples/httpserver/sampling-fingers-crossed" target="_blank" rel="noopener noreferrer" class=""><code>examples/httpserver/sampling-fingers-crossed</code></a>.</p>
<p>At runtime, you often want a quick escape hatch: “sample this one request” or “don’t sample this request”.</p>
<p>Gosoline’s HTTP server installs sampling middleware early, and it supports an override header:</p>
<ul>
<li class=""><code>X-Goso-Sampled: true</code> or <code>false</code> (parsed as a boolean)</li>
</ul>
<p>So you can do:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -H 'X-Goso-Sampled: true' https://service.example/api/expensive-call</span><br></span></code></pre></div></div>
<p>In sampled requests, logs behave normally (written immediately).</p>
<p>In not-sampled requests, gosoline uses a fingers-crossed scope: logs are buffered and then flushed automatically when the request fails (HTTP status <code>&gt;= 400</code>). This is particularly effective for 500s: you get the full pre-error story without turning the whole service noisy.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rollout-guidance-practical-tips">Rollout guidance (practical tips)<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#rollout-guidance-practical-tips" class="hash-link" aria-label="Direct link to Rollout guidance (practical tips)" title="Direct link to Rollout guidance (practical tips)" translate="no">​</a></h2>
<p>A few things that make this go smoothly:</p>
<ul>
<li class="">Start with low sampling rates (or tracing-based sampling), then tune.</li>
<li class="">Decide what “failure” means for your system. For HTTP it’s natural to flush on <code>&gt;= 400</code>, but if your APIs return 4xx for expected control-flow, you may want to review that behavior and/or your status conventions.</li>
<li class="">Treat sampling as an <em>observability strategy</em>, not just a logging trick: it works best when logs, tracing, and message processing all use the same “sampled/not-sampled” decision.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="closing-why-this-is-worth-it">Closing: why this is worth it<a href="https://gosoline-project.github.io/docs/blog/sampling-fingers-crossed-logging#closing-why-this-is-worth-it" class="hash-link" aria-label="Direct link to Closing: why this is worth it" title="Direct link to Closing: why this is worth it" translate="no">​</a></h2>
<p>This combo is a good fit for Go services because it leans into Go’s strengths:</p>
<ul>
<li class=""><code>context.Context</code> is already the idiomatic carrier of request-scoped state</li>
<li class="">middleware boundaries (HTTP, consumers, jobs) are natural points to decide and propagate sampling</li>
<li class="">you can keep production cheap and quiet, while still having deep debugging data when it matters</li>
</ul>]]></content>
        <author>
            <name>Jan Kamieth</name>
            <uri>https://github.com/j4k4</uri>
        </author>
        <category label="logging" term="logging"/>
        <category label="sampling" term="sampling"/>
        <category label="observability" term="observability"/>
    </entry>
</feed>